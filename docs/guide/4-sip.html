<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Showcasing Illiterate Programs</title>
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">

<link href="../docs-assets/Contents.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Progress.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Navigation.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Fonts.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Base.css" rel="stylesheet" rev="stylesheet" type="text/css">
<script src="http://code.jquery.com/jquery-1.12.4.min.js"
	integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>

<script src="../docs-assets/Bigfoot.js"></script>
<link href="../docs-assets/Bigfoot.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body class="commentary-font">
		<nav role="navigation">
		<h1><a href="../index.html"><img src="../docs-assets/Octagram.png" height=72> </a></h1>
<ul><li><a href="../inweb/index.html">inweb</a></li>
</ul><h2>Foundation Modules</h2><ul>
<li><a href="../foundation-module/index.html">foundation</a></li>
<li><a href="../foundation-test/index.html">foundation-test</a></li>
<li><a href="../literate-module/index.html">literate</a></li>
<li><a href="../literate-test/index.html">literate-test</a></li>
</ul><h2>Documentation</h2><ul>
<li><a href="index.html"><span class="selectedlink">guide</span></a></li>
</ul><h2>Example Webs</h2><ul>
<li><a href="../goldbach/index.html">goldbach</a></li>
<li><a href="../twinprimes/twinprimes.html">twinprimes</a></li>
<li><a href="../eastertide/index.html">eastertide</a></li>
</ul><h2>Repository</h2><ul>
<li><a href="https://github.com/ganelson/inweb"><img src="../docs-assets/github.png" height=0> github</a></li>
</ul><h2>Related Projects</h2><ul>
<li><a href="https://github.com/ganelson/inform"><img src="../docs-assets/github.png" height=0> inform</a></li>
<li><a href="https://github.com/ganelson/intest"><img src="../docs-assets/github.png" height=0> intest</a></li>
</ul>
		</nav>
		<main role="main">
		<!-- Weave of 'Showcasing Illiterate Programs' generated by inweb -->
<div class="breadcrumbs">
    <ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="index.html">The Inweb Guide</a></li><li><a href="index.html#4">Chapter 4: Notations</a></li><li><b>Showcasing Illiterate Programs</b></li></ul></div>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP1" class="paragraph-anchor"></a> One easy use of notations is to turn an existing program, never written to be
literate, into a valid web, by recognising certain patterns in the source code
and dividing up the material accordingly.</p>
<p>While this will never be useful from the point of view of compilation — these
webs will never need to be tangled — it makes it possible for Inweb to weave
many existing programs into legible websites.</p>
<h2>Example: An assembly language classic</h2>
<p>Here is a fragment from the BBC Micro MOS, &quot;machine operating system&quot;, written
by Acorn in around 1982 for its breakthrough microcomputer. The source here is
tidily set out (using ACME assembly language for the 6502 microprocessor), and
is taken from Toby Nelson's excellent commentary. So there is content worth
reading. But it is not in any obvious way a literate program able to be run
through Inweb:</p>
<pre><code>; ***************************************************************************************
;
;   VDU 1       Send next byte to printer only
;
; ***************************************************************************************
.vdu1EntryPoint
	TAX                                                 ; remember A
	LDA .vduStatusByte                                  ; get VDU status byte
	LSR                                                 ; get bit 0 into carry (printer enabled bit)
	BCC .exit                                           ; if (printer not enabled) then branch (exit)
	TXA                                                 ; restore A
	JMP .sendValidByteToPrinter                         ; send byte in A (next byte) to printer

; ***************************************************************************************
.explicitAddressNoParameters
	STA .vduJumpVectorHigh                              ; upper byte of link address
	TYA                                                 ; restore A (the VDU number)

	; set carry if VDU number is within range 8-13 (cursor movement)
	CMP #8                                              ;
	BCC +                                               ; if (VDU number &lt; 8) then branch (carry clear)
	EOR #$FF                                            ; invert value
	CMP #$F2                                            ; if (VDU number &gt; 13) then clear carry
	EOR #$FF                                            ; re-invert value back again
</code></pre>
<p>Of course, there's a lot more of that: the MOS occupied a 16K ROM, and was a
masterpiece of design for its time.</p>
<p>Suppose we take that material and put it into a file called <code>vdu.a.mossy</code>. The
<code>.a</code> part refers to ACME assembly language: one of the languages which Inweb
knows how to syntax-colour, as it happens. The <code>.mossy</code> part indicates the
notation — we will create a new notation called &quot;Mossy&quot;, just for the MOS.</p>
<p>And really, there's nothing to it. Here is <code>mossy.inweb</code>:</p>
<pre><code>Notation &quot;Mossy&quot; {
	recognise .mossy
	recognise .*.mossy

	classify
		; *************************************************************************************** ==&gt; beginparagraph if in extract context
		; *************************************************************************************** ==&gt; commentary
		; MATERIAL          ==&gt; commentary
		;                   ==&gt; commentary
		MATERIAL			==&gt; code
	end
}
</code></pre>
<p>Even this tiny definition gets things well under way. The basic split is that
lines with <code>;</code> in column 1 are comments, and other lines are code. But within
the comment, we also want to clear out those fences of asterisks. Note the
way these are dealt with: if Inweb is reading code, it treats the asterisks
as a paragraph break, thus ending code and entering commentary; if it isn't
reading code, it ignores the asterisks completely — that's because, although
the line is classified as <code>commentary</code>, nothing was put into <code>MATERIAL</code>, so
no actual content got through.</p>
<p>And now we're off to the races:</p>
<pre><code>inweb weave vdu.a.mossy -using mossy.inweb -creating
weaving web &quot;Untitled&quot; (ACME program in Mossy notation) as HTML
(created directory 'vdu-assets')
	generated: vdu.html
	11 files copied to: vdu-assets
</code></pre>
<p>So much for a single fragment of code. More ambitiously, the next task is to
present a slew of assembly files, which will become the sections of a multi-file web.</p>
<p>For simplicity, we'll suppose just two source files, called <code>star.a</code> and <code>vdu.a</code>,
and put them in a directory called <code>mos</code>. That will be the web directory. There's
no need now to tack <code>.mossy</code> onto the filenames, because the contents page will
see to all that. The contents page will be called <code>Contents.inweb</code>, and will look
like this:</p>
<pre><code>Title: MOS
Author: Acorn Computers
Notation: Mossy
Language: ACME
Purpose: The operating system used by the 1982 BBC Micro.
Version Number: 1.2

Sections
	&quot;VDU&quot; at &quot;vdu.a&quot;
	&quot;Star commands&quot; at &quot;star.a&quot;

Notation &quot;Mossy&quot; {
	recognise .mossy
	recognise .*.mossy

	classify
		; Chapter: MATERIAL     ==&gt; title
		; *************************************************************************************** ==&gt; beginparagraph if in extract context
		; *************************************************************************************** ==&gt; commentary
		; MATERIAL              ==&gt; commentary
		;                       ==&gt; commentary
		MATERIAL				==&gt; code
	end
}
</code></pre>
<p>Note that it <em>contains</em> the definition of <code>Mossy</code>, so there's no need now for a
sidekick file called <code>mossy.inweb</code>, and no need to keep saying <code>-using mossy.inweb</code>
in commands about the <code>mos</code> web: the web sees this definition all by itself.</p>
<p>Another plus of having a contents page is that it gives the web some metadata:</p>
<pre><code>$ inweb inspect mos -metadata
web &quot;MOS&quot; (ACME program in Mossy notation): 2 sections : 9 paragraphs : 179 lines

Title: MOS
Author: Acorn Computers
Purpose: The operating system used by the 1982 BBC Micro.
Language: ACME
Notation: Mossy
Semantic Version Number: 1.2
Version Number: 1.2
</code></pre>
<p>The source files, here <code>vdu.a</code> and <code>star.a</code>, are longer now. Suppose they start
like this:</p>
<pre><code>; ***************************************************************************************
; ***************************************************************************************
;
; Chapter: Star commands
;
; ***************************************************************************************
; ***************************************************************************************

; ***************************************************************************************
;
; Clear four consecutive bytes in the OSFILE block
;
; The data required by the OSFILE call is stored at .osfileBlockStart, is 18 bytes long, and
; is as follows:
</code></pre>
<p>...and so on. We want to pick the chapter headings out, which is why the notation
slipped in an extra classification line:</p>
<pre><code>		; Chapter: MATERIAL     ==&gt; title
</code></pre>
<p>This means Inweb reads the section <code>star.a</code> as having the title &quot;Star commands&quot;.</p>
<p>Because of Inweb's rule that the contents page must always agree with the section
files themselves about what the titles of the sections are, we have to write
the contents like this:</p>
<pre><code>Sections
	&quot;VDU&quot; at &quot;vdu.a&quot;
	&quot;Star commands&quot; at &quot;star.a&quot;
</code></pre>
<p>rather than like this:</p>
<pre><code>Sections
	vdu.a
	star.a
</code></pre>
<p>(If we wrote the latter, Inweb would complain that the section entitled &quot;star.a&quot;
seemed actually to be called &quot;Star commands&quot;.)</p>
<p>Setting up the contents page was a little fuss, but now we get a neat little
website as the reward:</p>
<pre><code>inweb weave mos -creating
weaving web &quot;MOS&quot; (ACME program in Mossy notation) as HTML
(created directory 'mos/Woven/assets')
	[mos/Woven/vd.html] [stcm]
	[index]
	10 files copied to: mos/Woven/assets
</code></pre>
<h2>Example: Semiliterate C</h2>
<p>An alternative use case now: taking a non-literate program, adding comments to
it in a particular format, and making it &quot;semiliterate&quot; — that is, able to
be woven attractively, but with no need for it to be tangled.</p>
<p>This time the program will be:</p>
<pre><code>/// # Getting started

#include&lt;stdio.h&gt;

/// # Numerical approximations
///
/// The actual work is done here, and relies on the power series expansion:
/// $$ e^x = \sum_{n=0}^\infty {{x^n}\over{n!}} $$
/// so that we can at least hope that
/// $$ e \approx  \sum_{n=0}^{20} {{1}\over{n!}} $$

double compute_e(void) {
	double e = 0.0, factorial = 1.0;
	for (int n=0; n&lt;=20; n++) {
		if (n &gt; 0) factorial *= n;
		e += 1.0/factorial;
	}
	return e;
}

/// # Main
///
/// And we wrap that in the usual C interface.

int main(int argc, char *argv[]) {
	printf(&quot;e = %.10g\n&quot;, compute_e());
	return 0;       /* this is **very important** to ensure a clean exit */
}
</code></pre>
<p>Note that this is a valid ANSI C program, and requires no tangling to run:</p>
<pre><code>$ cd jasmine
$ clang main.c
$ ./a.out
e = 2.718281828
</code></pre>
<p>(which, despite the crudeness of the method, is the right answer). So there
is no point in tangling: but if we supply also the following contents page —</p>
<pre><code>Title: Jasmine
Author: Graham Nelson
Notation: SemiliterateC
Language: C
Purpose: Exemplary.

Sections
	main.c

Notation &quot;SemiliterateC&quot; {
	classify
		/// # MATERIAL      ==&gt; beginparagraph
		/// MATERIAL        ==&gt; commentary
		///                 ==&gt; commentary
		MATERIAL		    ==&gt; code
	end

	Conventions {
		comments can contain styling
	}
}
</code></pre>
<p>then we can weave the program directly to a website which contains mathematical
formulae, headings, a contents page, and so on:</p>
<pre><code>inweb weave jasmine -creating
weaving web &quot;Jasmine&quot; (C program in SemiliterateC notation) as HTML
	[jasmine/Woven/mn.html]
	[index]
	11 files copied to: jasmine/Woven/assets
</code></pre>
</div>
<nav role="progress"><div class="progresscontainer">
    <ul class="progressbar"><li class="progressprev"><a href="4-cn.html">&#10094;</a></li><li class="progresschapter"><a href="1-gs.html">1</a></li><li class="progresschapter"><a href="2-cp.html">2</a></li><li class="progresschapter"><a href="3-cln.html">3</a></li><li class="progresscurrentchapter">4</li><li class="progresssection"><a href="4-an.html">an</a></li><li class="progresssection"><a href="4-in.html">in</a></li><li class="progresssection"><a href="4-wac.html">wac</a></li><li class="progresssection"><a href="4-cn.html">cn</a></li><li class="progresscurrent">sip</li><li class="progresssection"><a href="4-son.html">son</a></li><li class="progresschapter"><a href="5-wikal.html">5</a></li><li class="progresschapter"><a href="6-ap.html">6</a></li><li class="progresschapter"><a href="7-bn.html">7</a></li><li class="progressnext"><a href="4-son.html">&#10095;</a></li></ul></div>
</nav><!-- End of weave -->

		</main>
	</body>
</html>

