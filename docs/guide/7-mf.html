<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Make Files</title>
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">

<link href="../docs-assets/Contents.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Progress.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Navigation.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Fonts.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Base.css" rel="stylesheet" rev="stylesheet" type="text/css">
<script src="http://code.jquery.com/jquery-1.12.4.min.js"
	integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>

<script src="../docs-assets/Bigfoot.js"></script>
<link href="../docs-assets/Bigfoot.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body class="commentary-font">
		<nav role="navigation">
		<h1><a href="../index.html"><img src="../docs-assets/Octagram.png" height=72> </a></h1>
<ul><li><a href="../inweb/index.html">inweb</a></li>
</ul><h2>Foundation Modules</h2><ul>
<li><a href="../foundation-module/index.html">foundation</a></li>
<li><a href="../foundation-test/index.html">foundation-test</a></li>
<li><a href="../literate-module/index.html">literate</a></li>
<li><a href="../literate-test/index.html">literate-test</a></li>
</ul><h2>Documentation</h2><ul>
<li><a href="index.html"><span class="selectedlink">guide</span></a></li>
</ul><h2>Example Webs</h2><ul>
<li><a href="../goldbach/index.html">goldbach</a></li>
<li><a href="../twinprimes/twinprimes.html">twinprimes</a></li>
<li><a href="../eastertide/index.html">eastertide</a></li>
</ul><h2>Repository</h2><ul>
<li><a href="https://github.com/ganelson/inweb"><img src="../docs-assets/github.png" height=0> github</a></li>
</ul><h2>Related Projects</h2><ul>
<li><a href="https://github.com/ganelson/inform"><img src="../docs-assets/github.png" height=0> inform</a></li>
<li><a href="https://github.com/ganelson/intest"><img src="../docs-assets/github.png" height=0> intest</a></li>
</ul>
		</nav>
		<main role="main">
		<!-- Weave of 'Make Files' generated by inweb -->
<div class="breadcrumbs">
    <ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="index.html">The Inweb Guide</a></li><li><a href="index.html#7">Chapter 7: Other Services</a></li><li><b>Make Files</b></li></ul></div>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP1" class="paragraph-anchor"></a> Inweb provides a system for generating <em>makefiles</em>, that is, build instructions
to be used by the Unix utility <code>make</code>, much like its system for generating
<a href="7-rf.html" class="internal">README Files</a>. The command <code>inweb make-makefile</code> works almost exactly like
<code>inweb make-readme</code>, and once again generates a makefile from a script:</p>
<pre><code>$ inweb make-makefile smorgasbord
smorgasbord/smorgasbord.mkscript -&gt; smorgasbord/smorgasbord.mk
</code></pre>
<p>A new switch, <code>-platform X</code>, allows the platform (i.e. operating system)
being targeted to be changed: by default, this is whatever Inweb is running
on, but with <code>-platform windows</code>, Inweb on MacOS can cosplay.</p>
<p>As for README scripts, the braces <code>{</code> and <code>}</code> are significant, and all of the
same rules apply: <code>{set ...}</code> can create variables, <code>{repeat ...}</code> can provide
loops, <code>{define ...}</code> can create new macros. In addition, the following
make-related macros are available:</p>
<ul>
<li>
<p><code>{platform-settings}</code> splices in a set of platform-specific definitions
for compiling C-like programs on the platform (i.e., operating system) in
which Inweb has been installed. If you're using Windows, they will be Windows
settings, and so on.</p>
</li>
<li>
<p><code>{identity-settings}</code> splices in four constant declarations:</p>
<ul>
<li><code>INWEB</code> is the path to the Inweb executable;</li>
<li><code>INTEST</code> similarly for Intest;</li>
<li><code>MYNAME</code> is the directory name in which the web is held;</li>
<li><code>ME</code> is the pathname of this directory.</li>
</ul>
</li>
<li>
<p><code>{dependent-files tool: TOOL}</code>, or <code>{dependent-files module: MODULES}</code>, or
<code>{dependent-files tool-and-modules: BOTH}</code> all produce a run of the source files
on which a tangle of a web is dependent. Basically, a web needs to be tangled
again and recompiled after each time any of its section files changes, or its
contents page changes, or the libraries it's using (as modules) have changed.
Compiling lists of such dependent files by hand is liable to result in
accidental omissions. <code>{dependent-files}</code> alone means all the files on which
a tangle of the current web depends.</p>
</li>
<li>
<p><code>{modify-filenames original: FILE prefix: PREFIX suffix: SUFFIX}</code> takes the
filename and adds either a prefix or a suffix to the unextended leafname.
Both prefix and suffix clauses are optional, but of course if both are
missing then nothing changes.</p>
<p>For example, the following needs to compile something twice, once for each
CPU architecture; if <code>TO</code> is, say, <code>binary.o</code>, then as modified this will be
<code>binary_x86.o</code> and <code>binary_arm.o</code>.</p>
<pre><code>{define: compile to: TO from: FROM ?options: OPTS}
    clang -std=c11 -c $(MANYWARNINGS) $(CCOPTSX) -g {OPTS} -o {modify-filenames original: {TO} suffix: _x86} {FROM}
    clang -std=c11 -c $(MANYWARNINGS) $(CCOPTSA) -g {OPTS} -o {modify-filenames original: {TO} suffix: _arm} {FROM}
{end-define}
</code></pre>
</li>
</ul>
<p>For example, here's a minimal script capable of incrementally tangling and
recompiling a C program:</p>
<pre><code>{platform-settings}

{identity-settings}

$(ME)/Tangled/$(MYNAME): {dependent-files}
	$(call make-me)

.PHONY: force
force:
	$(call make-me)

define make-me
	$(INWEB) tangle $(ME)
	{compile from: $(ME)/Tangled/$(MYNAME).c   to:   $(ME)/Tangled/$(MYNAME).o}
	{link from:    $(ME)/Tangled/$(MYNAME).o   to:   $(ME)/Tangled/$(MYNAME)$(EXEEXTENSION)}
endef
</code></pre>
<p>Note that the macros <code>{compile ...}</code> and <code>{link ...}</code> are defined in the platform
settings, as is <code>EXEEXTENSION</code> (it's <code>.exe</code> on Windows and blank on most other
platforms), whereas <code>ME</code> and <code>MYNAME</code> are set in the identity settings.</p>
<h2>Conveniences for Inform</h2>
<p>The main Inform repository's makefile is especially convoluted because of the
very large number of webs in it, which fall into several different categories.
Inweb provides a couple of macros to help manage that.</p>
<ul>
<li>
<p><code>{component symbol: SYMBOL webname: WEBNAME path: PATH set: SET type: TYPE}</code>
declares one of the &quot;component&quot; webs which might need to be built. For example:</p>
<pre><code>{component type: module symbol: WORDS webname: words path: services/words-module set: modules}
</code></pre>
<p>tells Inweb that it needs to know about the module whose name in the colony is
<code>words</code>, but which will be identified in this makefile using the symbol <code>WORDS</code>,
and so on.</p>
</li>
<li>
<p><code>{components type: TYPE}</code> and <code>{end-components}</code> then provide a loop construct,
which loops through all components declared as having the given type. Within
the loop body, the variable <code>{SYMBOL}</code> holds the symbol of the current component.</p>
</li>
</ul>
</div>
<nav role="progress"><div class="progresscontainer">
    <ul class="progressbar"><li class="progressprev"><a href="7-rf.html">&#10094;</a></li><li class="progresschapter"><a href="1-gs.html">1</a></li><li class="progresschapter"><a href="2-cp.html">2</a></li><li class="progresschapter"><a href="3-cln.html">3</a></li><li class="progresschapter"><a href="4-an.html">4</a></li><li class="progresschapter"><a href="5-wikal.html">5</a></li><li class="progresschapter"><a href="6-ap.html">6</a></li><li class="progresscurrentchapter">7</li><li class="progresssection"><a href="7-bn.html">bn</a></li><li class="progresssection"><a href="7-rf.html">rf</a></li><li class="progresscurrent">mf</li><li class="progresssection"><a href="7-gf.html">gf</a></li><li class="progressnext"><a href="7-gf.html">&#10095;</a></li></ul></div>
</nav><!-- End of weave -->

		</main>
	</body>
</html>

