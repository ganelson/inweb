<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Line Classification</title>
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">

<link href="../docs-assets/Contents.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Progress.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Navigation.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Fonts.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Base.css" rel="stylesheet" rev="stylesheet" type="text/css">
<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="../docs-assets/Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body class="commentary-font">
		<nav role="navigation">
		<h1><a href="../index.html"><img src="../docs-assets/Octagram.png" height=72> </a></h1>
<ul><li><a href="../inweb/index.html">inweb</a></li>
</ul><h2>Foundation Modules</h2><ul>
<li><a href="../foundation-module/index.html">foundation</a></li>
<li><a href="../foundation-test/index.html">foundation-test</a></li>
<li><a href="index.html"><span class="selectedlink">literate</span></a></li>
<li><a href="../literate-test/index.html">literate-test</a></li>
</ul><h2>Example Webs</h2><ul>
<li><a href="../goldbach/index.html">goldbach</a></li>
<li><a href="../twinprimes/twinprimes.html">twinprimes</a></li>
<li><a href="../eastertide/index.html">eastertide</a></li>
</ul><h2>Repository</h2><ul>
<li><a href="https://github.com/ganelson/inweb"><img src="../docs-assets/github.png" height=0> github</a></li>
</ul><h2>Related Projects</h2><ul>
<li><a href="https://github.com/ganelson/inform"><img src="../docs-assets/github.png" height=0> inform</a></li>
<li><a href="https://github.com/ganelson/intest"><img src="../docs-assets/github.png" height=0> intest</a></li>
</ul>
		</nav>
		<main role="main">
		<!-- Weave of 'Line Classification' generated by inweb -->
<div class="breadcrumbs">
    <ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="index.html">literate</a></li><li><a href="index.html#1">Chapter 1: Literate Programming</a></li><li><b>Line Classification</b></li></ul></div>
<p class="purpose">Literate source is usually very line-based, and so parsing it is a matter of deciding what sort of thing each line represents.</p>

<ul class="toc"><li><a href="1-lc.html#SP1">&#167;1. Major and minor</a></li><li><a href="1-lc.html#SP13">&#167;13. Classifications</a></li><li><a href="1-lc.html#SP14">&#167;14. Classifier functions</a></li></ul><hr class="tocbar">

<p class="commentary firstcommentary"><a id="SP1" class="paragraph-anchor"></a><b>&#167;1. Major and minor.</b>Lines are categorised by a combination of a "major" and "minor" category, with
the latter used to distinguish subvarieties.
</p>

<p class="commentary">No line ever has major category <span class="extract"><span class="extract-syntax">UNCLASSIFIED_MAJLC</span></span>, which is used only as a
null value, but many lines have minor <span class="extract"><span class="extract-syntax">NO_MINLC</span></span>, meaning that there's nothing
special about them.
</p>

<pre class="definitions code-font"><span class="definition-keyword">enum</span> <span class="constant-syntax">UNCLASSIFIED_MAJLC</span><span class="plain-syntax"> </span><span class="identifier-syntax">from</span><span class="plain-syntax"> </span><span class="constant-syntax">0</span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">NO_MINLC</span><span class="plain-syntax"> </span><span class="identifier-syntax">from</span><span class="plain-syntax"> </span><span class="constant-syntax">0</span>
</pre>
<p class="commentary firstcommentary"><a id="SP2" class="paragraph-anchor"></a><b>&#167;2. </b>Ordinary paragraph starts (such as in this present paragraph) have minor
<span class="extract"><span class="extract-syntax">NO_MINLC</span></span>, but those with named headings (such as in the "Major and minor"
case above) are <span class="extract"><span class="extract-syntax">HEADING_COMMAND_MINLC</span></span>, and the grander headings at the
top of a section ("Line Classification" above) are <span class="extract"><span class="extract-syntax">SECTION_HEADING_MINLC</span></span>.
</p>

<pre class="definitions code-font"><span class="definition-keyword">enum</span> <span class="constant-syntax">PARAGRAPH_START_MAJLC</span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">HEADING_COMMAND_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">PARAGRAPH_START_MAJLC</span></span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">SECTION_HEADING_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">PARAGRAPH_START_MAJLC</span></span>
</pre>
<p class="commentary firstcommentary"><a id="SP3" class="paragraph-anchor"></a><b>&#167;3. </b>Lines forming commentary material mostly have minor <span class="extract"><span class="extract-syntax">NO_MINLC</span></span>, with the
only exception being the optional "purpose" paras at the top of sections.
</p>

<pre class="definitions code-font"><span class="definition-keyword">enum</span> <span class="constant-syntax">COMMENTARY_MAJLC</span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">PURPOSE_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">COMMENTARY_MAJLC</span></span>
</pre>
<p class="commentary firstcommentary"><a id="SP4" class="paragraph-anchor"></a><b>&#167;4. </b>Blocks of code, whether intended for execution, or simply as displayed "text",
are held as extracts. Syntactically, an extract begins with an <span class="extract"><span class="extract-syntax">EXTRACT_START_MAJLC</span></span>
line, though this can sometimes be implicit (in which case its minor is always
<span class="extract"><span class="extract-syntax">CODE_MINLC</span></span>): if not, it signals what sort of extract follows.
</p>

<p class="commentary">Compiled code, then, lives in extracts with minors <span class="extract"><span class="extract-syntax">CODE_MINLC</span></span>, <span class="extract"><span class="extract-syntax">EARLY_MINLC</span></span>,
or <span class="extract"><span class="extract-syntax">VERY_EARLY_MINLC</span></span>. The other extract minors are for displayed text.
</p>

<pre class="definitions code-font"><span class="definition-keyword">enum</span> <span class="constant-syntax">EXTRACT_START_MAJLC</span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">CODE_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">EXTRACT_START_MAJLC</span></span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">EARLY_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">EXTRACT_START_MAJLC</span></span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">VERY_EARLY_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">EXTRACT_START_MAJLC</span></span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">TEXT_AS_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">EXTRACT_START_MAJLC</span></span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">TEXT_FROM_AS_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">EXTRACT_START_MAJLC</span></span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">TEXT_FROM_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">EXTRACT_START_MAJLC</span></span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">TEXT_TO_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">EXTRACT_START_MAJLC</span></span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">TEXT_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">EXTRACT_START_MAJLC</span></span>
</pre>
<p class="commentary firstcommentary"><a id="SP5" class="paragraph-anchor"></a><b>&#167;5. </b>Each individual code line has this major, and no minor:
</p>

<pre class="definitions code-font"><span class="definition-keyword">enum</span> <span class="constant-syntax">EXTRACT_MATTER_MAJLC</span>
</pre>
<p class="commentary firstcommentary"><a id="SP6" class="paragraph-anchor"></a><b>&#167;6. </b>And an extract ends with this line, which again may be implicit in some
web syntaxes. Again it has no minor.
</p>

<pre class="definitions code-font"><span class="definition-keyword">enum</span> <span class="constant-syntax">EXTRACT_END_MAJLC</span>
</pre>
<p class="commentary firstcommentary"><a id="SP7" class="paragraph-anchor"></a><b>&#167;7. </b>A definition of a constant begins (and often consists only of) a <span class="extract"><span class="extract-syntax">DEFINITION_MAJLC</span></span>
line, which has one of the three minors given below.
</p>

<pre class="definitions code-font"><span class="definition-keyword">enum</span> <span class="constant-syntax">DEFINITION_MAJLC</span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">DEFINE_COMMAND_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">DEFINITION_MAJLC</span></span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">DEFAULT_COMMAND_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">DEFINITION_MAJLC</span></span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">ENUMERATE_COMMAND_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">DEFINITION_MAJLC</span></span>
</pre>
<p class="commentary firstcommentary"><a id="SP8" class="paragraph-anchor"></a><b>&#167;8. </b>Definitions can continue onto multiple lines, and if so, all after the first
have this major, and no minor:
</p>

<pre class="definitions code-font"><span class="definition-keyword">enum</span> <span class="constant-syntax">DEFINITION_CONTINUED_MAJLC</span>
</pre>
<p class="commentary firstcommentary"><a id="SP9" class="paragraph-anchor"></a><b>&#167;9. </b>A named holon of code has its declaration line, i.e., the one giving the name
of the code followed usually by an equals sign, with this major:
</p>

<pre class="definitions code-font"><span class="definition-keyword">enum</span> <span class="constant-syntax">HOLON_DECLARATION_MAJLC</span>
</pre>
<p class="commentary firstcommentary"><a id="SP10" class="paragraph-anchor"></a><b>&#167;10. </b>An insertion marks to include a picture or similar in the woven web, and
always has one of the following minors.
</p>

<pre class="definitions code-font"><span class="definition-keyword">enum</span> <span class="constant-syntax">INSERTION_MAJLC</span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">AUDIO_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">INSERTION_MAJLC</span></span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">CAROUSEL_ABOVE_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">INSERTION_MAJLC</span></span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">CAROUSEL_BELOW_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">INSERTION_MAJLC</span></span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">CAROUSEL_END_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">INSERTION_MAJLC</span></span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">CAROUSEL_SLIDE_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">INSERTION_MAJLC</span></span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">DOWNLOAD_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">INSERTION_MAJLC</span></span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">EMBEDDED_AV_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">INSERTION_MAJLC</span></span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">FIGURE_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">INSERTION_MAJLC</span></span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">HTML_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">INSERTION_MAJLC</span></span>
<span class="definition-keyword">enum</span> <span class="constant-syntax">VIDEO_MINLC</span><span class="plain-syntax"> </span><span class="comment-syntax"> minor of </span><span class="extract"><span class="extract-syntax">INSERTION_MAJLC</span></span>
</pre>
<p class="commentary firstcommentary"><a id="SP11" class="paragraph-anchor"></a><b>&#167;11. </b>Last and least, a feature which should perhaps go, for a sort of block-quotation
form of commentary:
</p>

<pre class="definitions code-font"><span class="definition-keyword">enum</span> <span class="constant-syntax">QUOTATION_MAJLC</span>
</pre>
<p class="commentary firstcommentary"><a id="SP12" class="paragraph-anchor"></a><b>&#167;12. </b>The following conditions are useful for deciding what a line might be, on the
basis of what the previous one was:
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="function-syntax">LineClassification::extract_lines_can_follow</span><button class="popup" onclick="togglePopup('usagePopup1')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup1">Usage of <span class="code-font"><span class="function-syntax">LineClassification::extract_lines_can_follow</span></span>:<br/><a href="1-lc.html#SP17">&#167;17</a><br/>Web Notations - <a href="1-wn.html#SP22">&#167;22</a></span></button><span class="plain-syntax">(</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">major</span><span class="plain-syntax">, </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">minor</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">switch</span><span class="plain-syntax"> (</span><span class="identifier-syntax">major</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">HOLON_DECLARATION_MAJLC:</span><span class="plain-syntax"> </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">TRUE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">EXTRACT_MATTER_MAJLC:</span><span class="plain-syntax"> </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">TRUE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">EXTRACT_START_MAJLC:</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> ((</span><span class="identifier-syntax">minor</span><span class="plain-syntax"> == </span><span class="constant-syntax">TEXT_FROM_MINLC</span><span class="plain-syntax">) || (</span><span class="identifier-syntax">minor</span><span class="plain-syntax"> == </span><span class="constant-syntax">TEXT_FROM_AS_MINLC</span><span class="plain-syntax">)) </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">FALSE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">TRUE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">FALSE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>

<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="function-syntax">LineClassification::definition_lines_can_follow</span><button class="popup" onclick="togglePopup('usagePopup2')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup2">Usage of <span class="code-font"><span class="function-syntax">LineClassification::definition_lines_can_follow</span></span>:<br/>Web Notations - <a href="1-wn.html#SP22">&#167;22</a></span></button><span class="plain-syntax">(</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">major</span><span class="plain-syntax">, </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">minor</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">switch</span><span class="plain-syntax"> (</span><span class="identifier-syntax">major</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">DEFINITION_CONTINUED_MAJLC:</span><span class="plain-syntax"> </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">TRUE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">DEFINITION_MAJLC:</span><span class="plain-syntax"> </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">TRUE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">FALSE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>
</pre>
<p class="commentary firstcommentary"><a id="SP13" class="paragraph-anchor"></a><b>&#167;13. Classifications.</b>The full classification of a line has details as well as the major/minor codes,
so it comes to quite a chunk of change, in memory terms. The three textual
operands are used differently for different major/minor pairs; the tag list
for a paragraph is the run of <span class="extract"><span class="extract-syntax">^"This"</span></span> and <span class="extract"><span class="extract-syntax">^"That"</span></span> markers at the end of
the line introducing that paragraph, so it's used only for <span class="extract"><span class="extract-syntax">PARAGRAPH_START_MAJLC</span></span>
lines.
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="reserved-syntax">typedef</span><span class="plain-syntax"> </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> </span><span class="reserved-syntax">ls_class</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">major</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">minor</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">options_bitmap</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">operand1</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">operand2</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">operand3</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">linked_list</span><span class="plain-syntax"> *</span><span class="identifier-syntax">tag_list</span><span class="plain-syntax">; </span><span class="comment-syntax"> of </span><span class="extract"><span class="extract-syntax">text_stream</span></span>
<span class="plain-syntax">} </span><span class="reserved-syntax">ls_class</span><span class="plain-syntax">;</span>

<span class="reserved-syntax">ls_class</span><span class="plain-syntax"> </span><span class="function-syntax">LineClassification::new</span><button class="popup" onclick="togglePopup('usagePopup3')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup3">Usage of <span class="code-font"><span class="function-syntax">LineClassification::new</span></span>:<br/><a href="1-lc.html#SP14">&#167;14</a>, <a href="1-lc.html#SP17_2_1">&#167;17.2.1</a><br/>Literate Source - <a href="1-ls.html#SP9">&#167;9</a>, <a href="1-ls.html#SP8_5_2">&#167;8.5.2</a>, <a href="1-ls.html#SP8_6">&#167;8.6</a></span></button><span class="plain-syntax">(</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">major</span><span class="plain-syntax">, </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">minor</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">ls_class</span><span class="plain-syntax"> </span><span class="identifier-syntax">cf</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">major</span><span class="plain-syntax"> = </span><span class="identifier-syntax">major</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">minor</span><span class="plain-syntax"> = </span><span class="identifier-syntax">minor</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">options_bitmap</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand2</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand3</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">tag_list</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">cf</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>

<span class="reserved-syntax">ls_class</span><span class="plain-syntax"> </span><span class="function-syntax">LineClassification::unclassified</span><button class="popup" onclick="togglePopup('usagePopup4')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup4">Usage of <span class="code-font"><span class="function-syntax">LineClassification::unclassified</span></span>:<br/><a href="1-lc.html#SP14">&#167;14</a>, <a href="1-lc.html#SP17_2_2">&#167;17.2.2</a>, <a href="1-lc.html#SP17_2_3">&#167;17.2.3</a><br/>Literate Source - <a href="1-ls.html#SP2">&#167;2</a>, <a href="1-ls.html#SP5_1">&#167;5.1</a>, <a href="1-ls.html#SP8_4_2">&#167;8.4.2</a></span></button><span class="plain-syntax">(</span><span class="reserved-syntax">void</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><a href="1-lc.html#SP13" class="function-link"><span class="function-syntax">LineClassification::new</span></a><span class="plain-syntax">(</span><span class="constant-syntax">UNCLASSIFIED_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">NO_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">}</span>
</pre>
<ul class="endnotetexts"><li>The structure ls_class is accessed in 1/ws, 1/ls, 1/wn, 1/tt2, 2/ca, 2/as, 2/is, 3/tw, 3/tf and here.</li></ul>
<p class="commentary firstcommentary"><a id="SP14" class="paragraph-anchor"></a><b>&#167;14. Classifier functions.</b>Each web syntax provides a classifier function, which takes a line of text,
together with the classification of the previous line, and returns the new
classification.
</p>

<p class="commentary">Actually, though, it also returns some other ephemera, so it actually returns
a larger structure, <span class="extract"><span class="extract-syntax">ls_class_parsing</span></span>, which additionally contains:
</p>

<ul class="items"><li>(a) <span class="extract"><span class="extract-syntax">implies_paragraph</span></span>, <span class="extract"><span class="extract-syntax">implies_extract</span></span>, <span class="extract"><span class="extract-syntax">implies_extract_end</span></span> are flags
which are set to indicate that a <span class="extract"><span class="extract-syntax">PARAGRAPH_START_MAJLC</span></span>, <span class="extract"><span class="extract-syntax">EXTRACT_START_MAJLC</span></span>
or <span class="extract"><span class="extract-syntax">EXTRACT_END_MAJLC</span></span> line should be considered to have been placed immediately
before the line just parsed (i.e., between the previous line and this one).
Note that it's possible to more than one such implication to arise for the
same line.
</li><li>(b) The most notable field here is <span class="extract"><span class="extract-syntax">residue</span></span>. Literate source is usually very
line-oriented, but not always, and sometimes a syntactic feature occupies
only the initial part of the line, with some left over: this, if it exists,
is put into the <span class="extract"><span class="extract-syntax">residue</span></span>.
</li><li>(c) If a syntax error is turned up on the line, it should be filled in as
text and placed in <span class="extract"><span class="extract-syntax">error</span></span>.
</li></ul>
<pre class="displayed-code all-displayed-code code-font">
<span class="reserved-syntax">typedef</span><span class="plain-syntax"> </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> </span><span class="reserved-syntax">ls_class_parsing</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> </span><span class="reserved-syntax">ls_class</span><span class="plain-syntax"> </span><span class="identifier-syntax">cf</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">implies_paragraph</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">implies_extract</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">implies_extract_end</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">residue</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> </span><span class="reserved-syntax">ls_class</span><span class="plain-syntax"> </span><span class="identifier-syntax">residue_cf</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">error</span><span class="plain-syntax">; </span><span class="comment-syntax"> filled in only when a parsing error occurs</span>
<span class="plain-syntax">} </span><span class="reserved-syntax">ls_class_parsing</span><span class="plain-syntax">;</span>

<span class="reserved-syntax">ls_class_parsing</span><span class="plain-syntax"> </span><span class="function-syntax">LineClassification::new_results</span><button class="popup" onclick="togglePopup('usagePopup5')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup5">Usage of <span class="code-font"><span class="function-syntax">LineClassification::new_results</span></span>:<br/><a href="1-lc.html#SP15">&#167;15</a>, <a href="1-lc.html#SP16">&#167;16</a>, <a href="1-lc.html#SP17_1">&#167;17.1</a>, <a href="1-lc.html#SP17_2">&#167;17.2</a>, <a href="1-lc.html#SP17_2_1">&#167;17.2.1</a><br/>Literate Source - <a href="1-ls.html#SP5_1">&#167;5.1</a></span></button><span class="plain-syntax">(</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">major</span><span class="plain-syntax">, </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">minor</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">ls_class_parsing</span><span class="plain-syntax"> </span><span class="identifier-syntax">results</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">results</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP13" class="function-link"><span class="function-syntax">LineClassification::new</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">major</span><span class="plain-syntax">, </span><span class="identifier-syntax">minor</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">results</span><span class="plain-syntax">.</span><span class="element-syntax">residue</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">results</span><span class="plain-syntax">.</span><span class="element-syntax">residue_cf</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP13" class="function-link"><span class="function-syntax">LineClassification::unclassified</span></a><span class="plain-syntax">();</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">results</span><span class="plain-syntax">.</span><span class="element-syntax">implies_paragraph</span><span class="plain-syntax"> = </span><span class="identifier-syntax">FALSE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">results</span><span class="plain-syntax">.</span><span class="element-syntax">implies_extract</span><span class="plain-syntax"> = </span><span class="identifier-syntax">FALSE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">results</span><span class="plain-syntax">.</span><span class="element-syntax">implies_extract_end</span><span class="plain-syntax"> = </span><span class="identifier-syntax">FALSE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">results</span><span class="plain-syntax">.</span><span class="element-syntax">error</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">results</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>

<span class="reserved-syntax">ls_class_parsing</span><span class="plain-syntax"> </span><span class="function-syntax">LineClassification::no_results</span><span class="plain-syntax">(</span><span class="reserved-syntax">void</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">UNCLASSIFIED_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">NO_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">}</span>

<span class="reserved-syntax">ls_class_parsing</span><span class="plain-syntax"> </span><span class="function-syntax">LineClassification::classify</span><button class="popup" onclick="togglePopup('usagePopup6')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup6">Usage of <span class="code-font"><span class="function-syntax">LineClassification::classify</span></span>:<br/>Literate Source - <a href="1-ls.html#SP5_1">&#167;5.1</a></span></button><span class="plain-syntax">(</span><span class="reserved-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">syntax</span><span class="plain-syntax">, </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">line</span><span class="plain-syntax">, </span><span class="reserved-syntax">ls_class</span><span class="plain-syntax"> *</span><span class="identifier-syntax">previously</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">ls_class_parsing</span><span class="plain-syntax"> </span><span class="identifier-syntax">results</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">syntax</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">line_classifier</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">results</span><span class="plain-syntax"> = (*(</span><span class="identifier-syntax">syntax</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">line_classifier</span><span class="plain-syntax">))(</span><span class="identifier-syntax">syntax</span><span class="plain-syntax">, </span><span class="identifier-syntax">line</span><span class="plain-syntax">, </span><span class="identifier-syntax">previously</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">results</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">major</span><span class="plain-syntax"> != </span><span class="constant-syntax">UNCLASSIFIED_MAJLC</span><span class="plain-syntax">) </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">results</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">results</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP17" class="function-link"><span class="function-syntax">LineClassification::rules_based_classifier</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">syntax</span><span class="plain-syntax">, </span><span class="identifier-syntax">line</span><span class="plain-syntax">, </span><span class="identifier-syntax">previously</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">results</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">major</span><span class="plain-syntax"> != </span><span class="constant-syntax">UNCLASSIFIED_MAJLC</span><span class="plain-syntax">) </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">results</span><span class="plain-syntax">;</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">results</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP16" class="function-link"><span class="function-syntax">LineClassification::all_code_classifier</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">syntax</span><span class="plain-syntax">, </span><span class="identifier-syntax">line</span><span class="plain-syntax">, </span><span class="identifier-syntax">previously</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">results</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>
</pre>
<ul class="endnotetexts"><li>The structure ls_class_parsing is accessed in 1/ls, 1/wn and here.</li></ul>
<p class="commentary firstcommentary"><a id="SP15" class="paragraph-anchor"></a><b>&#167;15. </b>Two trivial examples are provided here. The first classifies the entire file
as commentary, with no code in: in other words, regards the file as plain text.
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="reserved-syntax">ls_class_parsing</span><span class="plain-syntax"> </span><span class="function-syntax">LineClassification::all_commentary_classifier</span><span class="plain-syntax">(</span><span class="reserved-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">syntax</span><span class="plain-syntax">,</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">line</span><span class="plain-syntax">, </span><span class="reserved-syntax">ls_class</span><span class="plain-syntax"> *</span><span class="identifier-syntax">previously</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">ls_class_parsing</span><span class="plain-syntax"> </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">COMMENTARY_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">NO_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">previously</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">major</span><span class="plain-syntax"> == </span><span class="constant-syntax">UNCLASSIFIED_MAJLC</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">implies_paragraph</span><span class="plain-syntax"> = </span><span class="identifier-syntax">TRUE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">res</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>
</pre>
<p class="commentary firstcommentary"><a id="SP16" class="paragraph-anchor"></a><b>&#167;16. </b>And the second regards it as purely code, with no commentary:
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="reserved-syntax">ls_class_parsing</span><span class="plain-syntax"> </span><span class="function-syntax">LineClassification::all_code_classifier</span><button class="popup" onclick="togglePopup('usagePopup7')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup7">Usage of <span class="code-font"><span class="function-syntax">LineClassification::all_code_classifier</span></span>:<br/><a href="1-lc.html#SP14">&#167;14</a></span></button><span class="plain-syntax">(</span><span class="reserved-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">syntax</span><span class="plain-syntax">,</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">line</span><span class="plain-syntax">, </span><span class="reserved-syntax">ls_class</span><span class="plain-syntax"> *</span><span class="identifier-syntax">previously</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">ls_class_parsing</span><span class="plain-syntax"> </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">EXTRACT_MATTER_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">NO_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">line</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">previously</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">major</span><span class="plain-syntax"> == </span><span class="constant-syntax">UNCLASSIFIED_MAJLC</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">implies_paragraph</span><span class="plain-syntax"> = </span><span class="identifier-syntax">TRUE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">implies_extract</span><span class="plain-syntax"> = </span><span class="identifier-syntax">TRUE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">res</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>
</pre>
<p class="commentary firstcommentary"><a id="SP17" class="paragraph-anchor"></a><b>&#167;17. </b>This, more ambitiously, parses using the grammar for a syntax:
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="reserved-syntax">ls_class_parsing</span><span class="plain-syntax"> </span><span class="function-syntax">LineClassification::rules_based_classifier</span><button class="popup" onclick="togglePopup('usagePopup8')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup8">Usage of <span class="code-font"><span class="function-syntax">LineClassification::rules_based_classifier</span></span>:<br/><a href="1-lc.html#SP14">&#167;14</a></span></button><span class="plain-syntax">(</span><span class="reserved-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">syntax</span><span class="plain-syntax">,</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">line</span><span class="plain-syntax">, </span><span class="reserved-syntax">ls_class</span><span class="plain-syntax"> *</span><span class="identifier-syntax">previously</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">follows_extract</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP12" class="function-link"><span class="function-syntax">LineClassification::extract_lines_can_follow</span></a><span class="plain-syntax">(</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">previously</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">major</span><span class="plain-syntax">, </span><span class="identifier-syntax">previously</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">minor</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">first_line</span><span class="plain-syntax"> = (</span><span class="identifier-syntax">previously</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">major</span><span class="plain-syntax"> == </span><span class="constant-syntax">UNCLASSIFIED_MAJLC</span><span class="plain-syntax">)?</span><span class="identifier-syntax">TRUE:FALSE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::is_whitespace</span><span class="plain-syntax">(</span><span class="identifier-syntax">line</span><span class="plain-syntax">)) </span><span class="named-paragraph-container code-font"><a href="1-lc.html#SP17_1" class="named-paragraph-link"><span class="named-paragraph">Handle whitespace lines</span><span class="named-paragraph-number">17.1</span></a></span>
<span class="plain-syntax">    </span><span class="reserved-syntax">else</span><span class="plain-syntax"> </span><span class="named-paragraph-container code-font"><a href="1-lc.html#SP17_2" class="named-paragraph-link"><span class="named-paragraph">Handle nonwhitespace lines</span><span class="named-paragraph-number">17.2</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>
</pre>
<p class="commentary firstcommentary"><a id="SP17_1" class="paragraph-anchor"></a><b>&#167;17.1. </b>It might seem somewhat moot whether the empty line is commentary or code, but
in fact an important policy is expressed here: if a code fragment contains a
blank line, we want to read it as part of the code, in case code then continues
on subsequent lines. If we read all blank lines as commentary, then code
fragments would break up at blank lines.
</p>

<p class="commentary"><span class="named-paragraph-container code-font"><span class="named-paragraph-defn">Handle whitespace lines</span><span class="named-paragraph-number">17.1</span></span><span class="comment-syntax"> =</span>
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">follows_extract</span><span class="plain-syntax">) </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">EXTRACT_MATTER_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">NO_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">COMMENTARY_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">NO_MINLC</span><span class="plain-syntax">);</span>
</pre>
<ul class="endnotetexts"><li>This code is used in <a href="1-lc.html#SP17">&#167;17</a>.</li></ul>
<p class="commentary firstcommentary"><a id="SP17_2" class="paragraph-anchor"></a><b>&#167;17.2. </b>Otherwise, we consult the main grammar for our web syntax. If well-designed,
it will always match all nonempty lines of text. But if it should fail to
match, we consider that line to be code.
</p>

<p class="commentary"><span class="named-paragraph-container code-font"><span class="named-paragraph-defn">Handle nonwhitespace lines</span><span class="named-paragraph-number">17.2</span></span><span class="comment-syntax"> =</span>
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    </span><span class="reserved-syntax">ls_class_parsing</span><span class="plain-syntax"> </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">EXTRACT_MATTER_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">NO_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">TEMPORARY_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">TEMPORARY_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">second</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">TEMPORARY_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">third</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">TEMPORARY_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">options</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">TEMPORARY_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">residue</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">wildcards</span><span class="plain-syntax">[</span><span class="identifier-syntax">NO_DEFINED_LSWILDCARD_VALUES</span><span class="plain-syntax">];</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">i</span><span class="plain-syntax">=0; </span><span class="identifier-syntax">i</span><span class="plain-syntax">&lt;</span><span class="identifier-syntax">NO_DEFINED_LSWILDCARD_VALUES</span><span class="plain-syntax">; </span><span class="identifier-syntax">i</span><span class="plain-syntax">++) </span><span class="identifier-syntax">wildcards</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">] = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">wildcards</span><span class="plain-syntax">[</span><span class="constant-syntax">MATERIAL_LSWILDCARD</span><span class="plain-syntax">] = </span><span class="identifier-syntax">material</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">wildcards</span><span class="plain-syntax">[</span><span class="constant-syntax">SECOND_LSWILDCARD</span><span class="plain-syntax">] = </span><span class="identifier-syntax">second</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">wildcards</span><span class="plain-syntax">[</span><span class="constant-syntax">THIRD_LSWILDCARD</span><span class="plain-syntax">] = </span><span class="identifier-syntax">third</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">wildcards</span><span class="plain-syntax">[</span><span class="constant-syntax">OPTIONS_LSWILDCARD</span><span class="plain-syntax">] = </span><span class="identifier-syntax">options</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">wildcards</span><span class="plain-syntax">[</span><span class="constant-syntax">RESIDUE_LSWILDCARD</span><span class="plain-syntax">] = </span><span class="identifier-syntax">residue</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">ls_notation_rule</span><span class="plain-syntax"> *</span><span class="identifier-syntax">OR</span><span class="plain-syntax"> = </span><a href="1-wn.html#SP22" class="function-link"><span class="function-syntax">WebNotation::match</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">syntax</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">rules</span><span class="plain-syntax">, </span><span class="identifier-syntax">line</span><span class="plain-syntax">, </span><span class="identifier-syntax">wildcards</span><span class="plain-syntax">, </span><span class="identifier-syntax">previously</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">OR</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="named-paragraph-container code-font"><a href="1-lc.html#SP17_2_1" class="named-paragraph-link"><span class="named-paragraph">Translate the outcome and variables into a line classification</span><span class="named-paragraph-number">17.2.1</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">OR</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">new_paragraph</span><span class="plain-syntax">) </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">implies_paragraph</span><span class="plain-syntax"> = </span><span class="identifier-syntax">TRUE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">residue</span><span class="plain-syntax">) &gt; </span><span class="constant-syntax">0</span><span class="plain-syntax">) </span><span class="named-paragraph-container code-font"><a href="1-lc.html#SP17_2_2" class="named-paragraph-link"><span class="named-paragraph">Deal with the RESIDUE variable, if anything is in it</span><span class="named-paragraph-number">17.2.2</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">options</span><span class="plain-syntax">) &gt; </span><span class="constant-syntax">0</span><span class="plain-syntax">) </span><span class="named-paragraph-container code-font"><a href="1-lc.html#SP17_2_3" class="named-paragraph-link"><span class="named-paragraph">Deal with the OPTIONS variable, if anything is in it</span><span class="named-paragraph-number">17.2.3</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">OR</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">error</span><span class="plain-syntax">) &gt; </span><span class="constant-syntax">0</span><span class="plain-syntax">) </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">error</span><span class="plain-syntax"> = </span><span class="identifier-syntax">OR</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">error</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">DISCARD_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">DISCARD_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">second</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">DISCARD_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">third</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">DISCARD_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">options</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">DISCARD_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">residue</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">res</span><span class="plain-syntax">;</span>
</pre>
<ul class="endnotetexts"><li>This code is used in <a href="1-lc.html#SP17">&#167;17</a>.</li></ul>
<p class="commentary firstcommentary"><a id="SP17_2_1" class="paragraph-anchor"></a><b>&#167;17.2.1. </b>Sometimes, boring and repetitive code is the quickest:
</p>

<p class="commentary"><span class="named-paragraph-container code-font"><span class="named-paragraph-defn">Translate the outcome and variables into a line classification</span><span class="named-paragraph-number">17.2.1</span></span><span class="comment-syntax"> =</span>
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    </span><span class="reserved-syntax">switch</span><span class="plain-syntax"> (</span><span class="identifier-syntax">OR</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">outcome</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">COMMENTARY_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">COMMENTARY_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">NO_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> ((</span><span class="identifier-syntax">first_line</span><span class="plain-syntax">) || (</span><span class="identifier-syntax">follows_extract</span><span class="plain-syntax">)) </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">implies_paragraph</span><span class="plain-syntax"> = </span><span class="identifier-syntax">TRUE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">PURPOSE_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">COMMENTARY_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">PURPOSE_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> ((</span><span class="identifier-syntax">first_line</span><span class="plain-syntax">) || (</span><span class="identifier-syntax">follows_extract</span><span class="plain-syntax">)) </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">implies_paragraph</span><span class="plain-syntax"> = </span><span class="identifier-syntax">TRUE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">DEFINITION_CONTINUED_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">DEFINITION_CONTINUED_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">NO_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">QUOTATION_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">QUOTATION_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">NO_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">SECTIONTITLE_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">PARAGRAPH_START_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">SECTION_HEADING_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">second</span><span class="plain-syntax">) &gt; </span><span class="constant-syntax">0</span><span class="plain-syntax">) </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand2</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">second</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">HEADING_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">PARAGRAPH_START_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">NO_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">CODE_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">EXTRACT_MATTER_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">NO_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">follows_extract</span><span class="plain-syntax"> == </span><span class="identifier-syntax">FALSE</span><span class="plain-syntax">) </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">implies_extract</span><span class="plain-syntax"> = </span><span class="identifier-syntax">TRUE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">BREAK_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">COMMENTARY_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">NO_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::new</span><span class="plain-syntax">();</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> ((</span><span class="identifier-syntax">first_line</span><span class="plain-syntax">) || (</span><span class="identifier-syntax">follows_extract</span><span class="plain-syntax">)) </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">implies_paragraph</span><span class="plain-syntax"> = </span><span class="identifier-syntax">TRUE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">TITLE_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">PARAGRAPH_START_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">SECTION_HEADING_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">CODEEXTRACT_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">EXTRACT_START_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">CODE_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">EARLYCODEEXTRACT_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">EXTRACT_START_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">EARLY_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">VERYEARLYCODEEXTRACT_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">EXTRACT_START_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">VERY_EARLY_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">ENDEXTRACT_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">EXTRACT_END_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">NO_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">COMBINED_WSRULEOUTCOME:</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">PARAGRAPH_START_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">SECTION_HEADING_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">match_results</span><span class="plain-syntax"> </span><span class="identifier-syntax">mr</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Regexp::create_mr</span><span class="plain-syntax">();</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Regexp::match</span><span class="plain-syntax">(&amp;</span><span class="identifier-syntax">mr</span><span class="plain-syntax">, </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax">, </span><span class="identifier-syntax">U</span><span class="string-syntax">"(%c+): *(%c+)"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">mr</span><span class="plain-syntax">.</span><span class="identifier-syntax">exp</span><span class="plain-syntax">[0]);</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">residue</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">mr</span><span class="plain-syntax">.</span><span class="identifier-syntax">exp</span><span class="plain-syntax">[1]);</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">residue_cf</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP13" class="function-link"><span class="function-syntax">LineClassification::new</span></a><span class="plain-syntax">(</span><span class="constant-syntax">COMMENTARY_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">PURPOSE_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            }</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">Regexp::dispose_of</span><span class="plain-syntax">(&amp;</span><span class="identifier-syntax">mr</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">EXTRACT_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">EXTRACT_MATTER_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">TEXT_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">line</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">follows_extract</span><span class="plain-syntax"> == </span><span class="identifier-syntax">FALSE</span><span class="plain-syntax">) </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">implies_extract</span><span class="plain-syntax"> = </span><span class="identifier-syntax">TRUE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">AUDIO_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">INSERTION_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">AUDIO_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">VIDEO_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">INSERTION_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">VIDEO_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">FIGURE_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">INSERTION_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">FIGURE_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">second</span><span class="plain-syntax">) &gt; </span><span class="constant-syntax">0</span><span class="plain-syntax">) </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand2</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">second</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">HTML_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">INSERTION_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">HTML_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">DOWNLOAD_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">INSERTION_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">DOWNLOAD_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">second</span><span class="plain-syntax">) &gt; </span><span class="constant-syntax">0</span><span class="plain-syntax">) </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand2</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">second</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">EMBEDDEDVIDEO_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">INSERTION_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">EMBEDDED_AV_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand2</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">second</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">CAROUSELSLIDE_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">INSERTION_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">CAROUSEL_SLIDE_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">CAROUSELABOVE_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">INSERTION_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">CAROUSEL_ABOVE_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">CAROUSELBELOW_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">INSERTION_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">CAROUSEL_BELOW_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">CAROUSELEND_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">INSERTION_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">CAROUSEL_END_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>

<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">DEFINITION_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">DEFINITION_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">DEFINE_COMMAND_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand2</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">second</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>

<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">DEFAULT_DEFINITION_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">DEFINITION_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">DEFAULT_COMMAND_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand2</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">second</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>

<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">ENUMERATION_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">DEFINITION_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">ENUMERATE_COMMAND_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand2</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">second</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>

<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">NAMEDCODEFRAGMENT_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">HOLON_DECLARATION_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">NO_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">follows_extract</span><span class="plain-syntax">) </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">implies_paragraph</span><span class="plain-syntax"> = </span><span class="identifier-syntax">TRUE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>

<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">BEGINPARAGRAPH_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">) &gt; </span><span class="constant-syntax">0</span><span class="plain-syntax">)</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">PARAGRAPH_START_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">NO_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">else</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">PARAGRAPH_START_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">HEADING_COMMAND_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>

<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">TEXTEXTRACT_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">EXTRACT_START_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">TEXT_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">) &gt; </span><span class="constant-syntax">0</span><span class="plain-syntax">) </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">minor</span><span class="plain-syntax"> = </span><span class="constant-syntax">TEXT_AS_MINLC</span><span class="plain-syntax">;</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">second</span><span class="plain-syntax">) &gt; </span><span class="constant-syntax">0</span><span class="plain-syntax">) </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">minor</span><span class="plain-syntax"> = </span><span class="constant-syntax">TEXT_FROM_MINLC</span><span class="plain-syntax">;</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> ((</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">) &gt; </span><span class="constant-syntax">0</span><span class="plain-syntax">) &amp;&amp; (</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">second</span><span class="plain-syntax">) &gt; </span><span class="constant-syntax">0</span><span class="plain-syntax">)) </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">minor</span><span class="plain-syntax"> = </span><span class="constant-syntax">TEXT_FROM_AS_MINLC</span><span class="plain-syntax">;</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand2</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">second</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>

<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">TEXTASCODEEXTRACT_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">EXTRACT_START_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">TEXT_AS_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">second</span><span class="plain-syntax">) &gt; </span><span class="constant-syntax">0</span><span class="plain-syntax">) </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">minor</span><span class="plain-syntax"> = </span><span class="constant-syntax">TEXT_FROM_AS_MINLC</span><span class="plain-syntax">;</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand2</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">second</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>

<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">TEXTEXTRACTTO_WSRULEOUTCOME:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP14" class="function-link"><span class="function-syntax">LineClassification::new_results</span></a><span class="plain-syntax">(</span><span class="constant-syntax">EXTRACT_START_MAJLC</span><span class="plain-syntax">, </span><span class="constant-syntax">TEXT_TO_MINLC</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">operand1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>

<span class="plain-syntax">        </span><span class="identifier-syntax">default:</span><span class="plain-syntax"> </span><span class="identifier-syntax">internal_error</span><span class="plain-syntax">(</span><span class="string-syntax">"unimplemented rule outcome"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    }</span>
</pre>
<ul class="endnotetexts"><li>This code is used in <a href="1-lc.html#SP17_2">&#167;17.2</a>.</li></ul>
<p class="commentary firstcommentary"><a id="SP17_2_2" class="paragraph-anchor"></a><b>&#167;17.2.2. </b>Anything in the RESIDUE variable is passed back to become another "line" of
the source code, but first it is run through a special grammar depending on
the outcome. This is repeated until it returns without a match.
</p>

<p class="commentary">We don't want a poorly constructed grammar to hang us, so we throw in the
towel after what are clearly too many iterations.
</p>

<pre class="definitions code-font"><span class="definition-keyword">define</span> <span class="constant-syntax">MAX_RESIDUE_OR_OPTIONS_ITERATIONS</span><span class="plain-syntax"> </span><span class="constant-syntax">1000</span>
</pre>
<p class="commentary"><span class="named-paragraph-container code-font"><span class="named-paragraph-defn">Deal with the RESIDUE variable, if anything is in it</span><span class="named-paragraph-number">17.2.2</span></span><span class="comment-syntax"> =</span>
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">residue</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">residue</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">ls_class</span><span class="plain-syntax"> </span><span class="identifier-syntax">never</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP13" class="function-link"><span class="function-syntax">LineClassification::unclassified</span></a><span class="plain-syntax">();</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">ni</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">while</span><span class="plain-syntax"> ((</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">residue</span><span class="plain-syntax">) &gt; </span><span class="constant-syntax">0</span><span class="plain-syntax">) &amp;&amp; (</span><span class="identifier-syntax">ni</span><span class="plain-syntax">++ &lt; </span><span class="constant-syntax">MAX_RESIDUE_OR_OPTIONS_ITERATIONS</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">ls_notation_rule</span><span class="plain-syntax"> *</span><span class="identifier-syntax">RR</span><span class="plain-syntax"> = </span><a href="1-wn.html#SP22" class="function-link"><span class="function-syntax">WebNotation::match</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">syntax</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">residue_rules</span><span class="plain-syntax">[</span><span class="identifier-syntax">OR</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">outcome</span><span class="plain-syntax">],</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">residue</span><span class="plain-syntax">, </span><span class="identifier-syntax">wildcards</span><span class="plain-syntax">, &amp;</span><span class="identifier-syntax">never</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">RR</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="named-paragraph-container code-font"><a href="1-lc.html#SP17_2_2_1" class="named-paragraph-link"><span class="named-paragraph">Deal with a RESIDUE grammar match</span><span class="named-paragraph-number">17.2.2.1</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">RR</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">outcome</span><span class="plain-syntax"> == </span><span class="constant-syntax">PARAGRAPHTAG_WSRULEOUTCOME</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">tag</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">tag_list</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">tag_list</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NEW_LINKED_LIST</span><span class="plain-syntax">(</span><span class="identifier-syntax">text_stream</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">ADD_TO_LINKED_LIST</span><span class="plain-syntax">(</span><span class="identifier-syntax">tag</span><span class="plain-syntax">, </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax">, </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">tag_list</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">residue</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">residue</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    }</span>
</pre>
<ul class="endnotetexts"><li>This code is used in <a href="1-lc.html#SP17_2">&#167;17.2</a>.</li></ul>
<p class="commentary firstcommentary"><a id="SP17_2_2_1" class="paragraph-anchor"></a><b>&#167;17.2.2.1. </b>This mechanism was basically designed for peeling tags off of paragraph headings,
and at present that's the only thing a residue grammar can usefully match:
</p>

<p class="commentary"><span class="named-paragraph-container code-font"><span class="named-paragraph-defn">Deal with a RESIDUE grammar match</span><span class="named-paragraph-number">17.2.2.1</span></span><span class="comment-syntax"> =</span>
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    </span><span class="reserved-syntax">switch</span><span class="plain-syntax"> (</span><span class="identifier-syntax">RR</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">outcome</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">PARAGRAPHTAG_WSRULEOUTCOME:</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">tag</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">material</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">tag_list</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">tag_list</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NEW_LINKED_LIST</span><span class="plain-syntax">(</span><span class="identifier-syntax">text_stream</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">ADD_TO_LINKED_LIST</span><span class="plain-syntax">(</span><span class="identifier-syntax">tag</span><span class="plain-syntax">, </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax">, </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">tag_list</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">    }</span>
</pre>
<ul class="endnotetexts"><li>This code is used in <a href="1-lc.html#SP17_2_2">&#167;17.2.2</a>.</li></ul>
<p class="commentary firstcommentary"><a id="SP17_2_3" class="paragraph-anchor"></a><b>&#167;17.2.3. </b>The OPTIONS variable is handled similarly, but here the grammar needs to
exhaust the content completely, or there's an error.
</p>

<p class="commentary"><span class="named-paragraph-container code-font"><span class="named-paragraph-defn">Deal with the OPTIONS variable, if anything is in it</span><span class="named-paragraph-number">17.2.3</span></span><span class="comment-syntax"> =</span>
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    </span><span class="identifier-syntax">TEMPORARY_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">opts</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">WRITE_TO</span><span class="plain-syntax">(</span><span class="identifier-syntax">opts</span><span class="plain-syntax">, </span><span class="string-syntax">"%S"</span><span class="plain-syntax">, </span><span class="identifier-syntax">options</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">ls_class</span><span class="plain-syntax"> </span><span class="identifier-syntax">never</span><span class="plain-syntax"> = </span><a href="1-lc.html#SP13" class="function-link"><span class="function-syntax">LineClassification::unclassified</span></a><span class="plain-syntax">();</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">ni</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">while</span><span class="plain-syntax"> ((</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">opts</span><span class="plain-syntax">) &gt; </span><span class="constant-syntax">0</span><span class="plain-syntax">) &amp;&amp; (</span><span class="identifier-syntax">ni</span><span class="plain-syntax">++ &lt; </span><span class="constant-syntax">MAX_RESIDUE_OR_OPTIONS_ITERATIONS</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">ls_notation_rule</span><span class="plain-syntax"> *</span><span class="identifier-syntax">OPR</span><span class="plain-syntax"> = </span><a href="1-wn.html#SP22" class="function-link"><span class="function-syntax">WebNotation::match</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">syntax</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">options_rules</span><span class="plain-syntax">[</span><span class="identifier-syntax">OR</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">outcome</span><span class="plain-syntax">],</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">opts</span><span class="plain-syntax">, </span><span class="identifier-syntax">wildcards</span><span class="plain-syntax">, &amp;</span><span class="identifier-syntax">never</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">OPR</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="named-paragraph-container code-font"><a href="1-lc.html#SP17_2_3_1" class="named-paragraph-link"><span class="named-paragraph">Deal with an OPTIONS grammar match</span><span class="named-paragraph-number">17.2.3.1</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">Str::clear</span><span class="plain-syntax">(</span><span class="identifier-syntax">opts</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">Str::copy</span><span class="plain-syntax">(</span><span class="identifier-syntax">opts</span><span class="plain-syntax">, </span><span class="identifier-syntax">options</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">opts</span><span class="plain-syntax">) &gt; </span><span class="constant-syntax">0</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">error</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::new</span><span class="plain-syntax">();</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">WRITE_TO</span><span class="plain-syntax">(</span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">error</span><span class="plain-syntax">, </span><span class="string-syntax">"unknown material in options: '%S'"</span><span class="plain-syntax">, </span><span class="identifier-syntax">opts</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">DISCARD_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">opts</span><span class="plain-syntax">)</span>
</pre>
<ul class="endnotetexts"><li>This code is used in <a href="1-lc.html#SP17_2">&#167;17.2</a>.</li></ul>
<p class="commentary firstcommentary"><a id="SP17_2_3_1" class="paragraph-anchor"></a><b>&#167;17.2.3.1. </b><span class="named-paragraph-container code-font"><span class="named-paragraph-defn">Deal with an OPTIONS grammar match</span><span class="named-paragraph-number">17.2.3.1</span></span><span class="comment-syntax"> =</span>
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    </span><span class="reserved-syntax">switch</span><span class="plain-syntax"> (</span><span class="identifier-syntax">OPR</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">outcome</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">HYPERLINKED_WSRULEOUTCOME:</span><span class="plain-syntax"> </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">options_bitmap</span><span class="plain-syntax"> |= </span><span class="constant-syntax">1</span><span class="plain-syntax">; </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">UNDISPLAYED_WSRULEOUTCOME:</span><span class="plain-syntax"> </span><span class="identifier-syntax">res</span><span class="plain-syntax">.</span><span class="element-syntax">cf</span><span class="plain-syntax">.</span><span class="element-syntax">options_bitmap</span><span class="plain-syntax"> |= </span><span class="constant-syntax">2</span><span class="plain-syntax">; </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
</pre>
<ul class="endnotetexts"><li>This code is used in <a href="1-lc.html#SP17_2_3">&#167;17.2.3</a>.</li></ul>
<nav role="progress"><div class="progresscontainer">
    <ul class="progressbar"><li class="progressprev"><a href="1-ls.html">&#10094;</a></li><li class="progresschapter"><a href="P-abgtl.html">P</a></li><li class="progresscurrentchapter">1</li><li class="progresssection"><a href="1-lm.html">lm</a></li><li class="progresssection"><a href="1-wcl.html">wcl</a></li><li class="progresssection"><a href="1-cln.html">cln</a></li><li class="progresssection"><a href="1-ws.html">ws</a></li><li class="progresssection"><a href="1-bdfw.html">bdfw</a></li><li class="progresssection"><a href="1-wcp.html">wcp</a></li><li class="progresssection"><a href="1-sw.html">sw</a></li><li class="progresssection"><a href="1-wm.html">wm</a></li><li class="progresssection"><a href="1-wr.html">wr</a></li><li class="progresssection"><a href="1-ls.html">ls</a></li><li class="progresscurrent">lc</li><li class="progresssection"><a href="1-we.html">we</a></li><li class="progresssection"><a href="1-wn.html">wn</a></li><li class="progresssection"><a href="1-hln.html">hln</a></li><li class="progresssection"><a href="1-hs.html">hs</a></li><li class="progresssection"><a href="1-tt.html">tt</a></li><li class="progresssection"><a href="1-tt2.html">tt2</a></li><li class="progresssection"><a href="1-bf.html">bf</a></li><li class="progresschapter"><a href="2-pl.html">2</a></li><li class="progresschapter"><a href="3-wd.html">3</a></li><li class="progresschapter"><a href="4-mkf.html">4</a></li><li class="progressnext"><a href="1-we.html">&#10095;</a></li></ul></div>
</nav><!-- End of weave -->

		</main>
	</body>
</html>

