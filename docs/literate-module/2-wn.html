<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Web Notations</title>
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">

<link href="../docs-assets/Contents.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Progress.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Navigation.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Fonts.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Base.css" rel="stylesheet" rev="stylesheet" type="text/css">
<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="../docs-assets/Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
<script src="http://code.jquery.com/jquery-1.12.4.min.js"
	integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>

<script src="../docs-assets/Bigfoot.js"></script>
<link href="../docs-assets/Bigfoot.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body class="commentary-font">
		<nav role="navigation">
		<h1><a href="../index.html"><img src="../docs-assets/Octagram.png" height=72> </a></h1>
<ul><li><a href="../inweb/index.html">inweb</a></li>
</ul><h2>Foundation Modules</h2><ul>
<li><a href="../foundation-module/index.html">foundation</a></li>
<li><a href="../foundation-test/index.html">foundation-test</a></li>
<li><a href="index.html"><span class="selectedlink">literate</span></a></li>
<li><a href="../literate-test/index.html">literate-test</a></li>
</ul><h2>Documentation</h2><ul>
<li><a href="../guide/index.html">guide</a></li>
</ul><h2>Example Webs</h2><ul>
<li><a href="../goldbach/index.html">goldbach</a></li>
<li><a href="../twinprimes/twinprimes.html">twinprimes</a></li>
<li><a href="../eastertide/index.html">eastertide</a></li>
</ul><h2>Repository</h2><ul>
<li><a href="https://github.com/ganelson/inweb"><img src="../docs-assets/github.png" height=0> github</a></li>
</ul><h2>Related Projects</h2><ul>
<li><a href="https://github.com/ganelson/inform"><img src="../docs-assets/github.png" height=0> inform</a></li>
<li><a href="https://github.com/ganelson/intest"><img src="../docs-assets/github.png" height=0> intest</a></li>
</ul>
		</nav>
		<main role="main">
		<!-- Weave of 'Web Notations' generated by inweb -->
<div class="breadcrumbs">
    <ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="index.html">literate</a></li><li><a href="index.html#2">Chapter 2: Literate Code</a></li><li><b>Web Notations</b></li></ul></div>
<p class="purpose">To manage possible notations for writing programs in web form.</p>

<ul class="toc"><li><a href="2-wn.html#SP1">&#167;1. Introduction</a></li><li><a href="2-wn.html#SP3">&#167;3. Identification</a></li><li><a href="2-wn.html#SP6">&#167;6. Adoption and adaptation to conventions</a></li><li><a href="2-wn.html#SP8">&#167;8. Notation markers</a></li><li><a href="2-wn.html#SP9">&#167;9. Commentary markup</a></li><li><a href="2-wn.html#SP10">&#167;10. Reading notation definitions</a></li><li><a href="2-wn.html#SP16">&#167;16. Processing</a></li></ul><hr class="tocbar">

<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP1" class="paragraph-anchor"></a><b>&#167;1. Introduction.</b>  We want to provide a literate-programming engine which can handle a wide range
of different possible markup notations for LP.</p>
<p>Each notation is represented by a <code>ls_notation</code> object:</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="reserved-syntax">typedef</span><span class="plain-syntax"> </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">    </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="type-syntax">wcl_declaration</span><span class="plain-syntax"> *</span><span class="identifier-syntax">declaration</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">name</span><span class="plain-syntax">;</span>

<span class="plain-syntax">    </span><span class="comment-syntax">/* for deciding when a web might be using this notation */</span>
<span class="plain-syntax">    </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">linked_list</span><span class="plain-syntax"> *</span><span class="identifier-syntax">recognised_filename_extensions</span><span class="plain-syntax">; </span><span class="comment-syntax">/* of |text_stream| */</span>

<span class="plain-syntax">    </span><span class="comment-syntax">/* what aspects of LP are allowed under this notation, with what notations */</span>
<span class="plain-syntax">    </span><span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">footnotes_in_commentary</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">holons_trimmed_above</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">holons_trimmed_below</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">left_marker</span><span class="plain-syntax">[</span><span class="identifier-syntax">NO_DEFINED_NTNMARKER_VALUES</span><span class="plain-syntax">];</span>
<span class="plain-syntax">    </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">right_marker</span><span class="plain-syntax">[</span><span class="identifier-syntax">NO_DEFINED_NTNMARKER_VALUES</span><span class="plain-syntax">];</span>

<span class="plain-syntax">    </span><span class="comment-syntax">/* how input lines are classified when this notation is used */</span>
<span class="plain-syntax">    </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="type-syntax">ls_classifier</span><span class="plain-syntax"> *</span><span class="identifier-syntax">main_classifier</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="type-syntax">ls_classifier</span><span class="plain-syntax"> *</span><span class="identifier-syntax">residue_classifier</span><span class="plain-syntax">[</span><span class="identifier-syntax">NO_DEFINED_LSNROID_VALUES</span><span class="plain-syntax">];</span>
<span class="plain-syntax">    </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="type-syntax">ls_classifier</span><span class="plain-syntax"> *</span><span class="identifier-syntax">options_classifier</span><span class="plain-syntax">[</span><span class="identifier-syntax">NO_DEFINED_LSNROID_VALUES</span><span class="plain-syntax">];</span>

<span class="plain-syntax">    </span><span class="comment-syntax">/* how index entries are read from the web source */</span>
<span class="plain-syntax">    </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">finite_state_machine</span><span class="plain-syntax"> *</span><span class="identifier-syntax">indexing_machine</span><span class="plain-syntax">;</span>

<span class="plain-syntax">    </span><span class="comment-syntax">/* how the web source is rewritten before and after classification */</span>
<span class="plain-syntax">    </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="type-syntax">notation_rewriting_machine</span><span class="plain-syntax"> *</span><span class="identifier-syntax">preprocessor</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="type-syntax">notation_rewriting_machine</span><span class="plain-syntax"> *</span><span class="identifier-syntax">postprocessor</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="type-syntax">notation_rewriting_machine</span><span class="plain-syntax"> *</span><span class="identifier-syntax">code_preprocessor</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="type-syntax">notation_rewriting_machine</span><span class="plain-syntax"> *</span><span class="identifier-syntax">code_postprocessor</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="type-syntax">notation_rewriting_machine</span><span class="plain-syntax"> *</span><span class="identifier-syntax">commentary_preprocessor</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="type-syntax">notation_rewriting_machine</span><span class="plain-syntax"> *</span><span class="identifier-syntax">commentary_postprocessor</span><span class="plain-syntax">;</span>

<span class="plain-syntax">    </span><span class="comment-syntax">/* temporarily needed in parsing notation files */</span>
<span class="plain-syntax">    </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="type-syntax">ls_classifier</span><span class="plain-syntax"> *</span><span class="identifier-syntax">c_stanza</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="type-syntax">notation_rewriting_machine</span><span class="plain-syntax"> *</span><span class="identifier-syntax">p_stanza</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">CLASS_DEFINITION</span>
<span class="plain-syntax">} </span><span class="type-syntax">ls_notation</span><span class="plain-syntax">;</span>
</pre>
<ul class="endnotetexts"><li>The structure ls_notation is accessed in 1/wcl, 1/cln, 1/ws, 1/wcp, 1/sw, 1/cnv, 2/ls, 2/lc, 2/hln, 2/hs, 2/wi, 3/pl, 3/tp, 4/cs, 5/ts, 5/ptt, 5/apacs, 5/wt, 6/rw, 6/bf and here.</li></ul>
<p class="commentary firstcommentary"><a id="SP2" class="paragraph-anchor"></a><b>&#167;2. </b> </p>

<pre class="displayed-code all-displayed-code code-font">
<span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="function-syntax">WebNotation::new</span><button class="popup" onclick="togglePopup('usagePopup1')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup1">Usage of <span class="code-font"><span class="function-syntax">WebNotation::new</span></span>:<br/><a href="2-wn.html#SP12">&#167;12</a></span></button><span class="plain-syntax">(</span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">name</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">ntn</span><span class="plain-syntax"> = </span><span class="identifier-syntax">CREATE</span><span class="plain-syntax">(</span><span class="type-syntax">ls_notation</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">declaration</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">name</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">name</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">recognised_filename_extensions</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NEW_LINKED_LIST</span><span class="plain-syntax">(</span><span class="identifier-syntax">text_stream</span><span class="plain-syntax">);</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">footnotes_in_commentary</span><span class="plain-syntax"> = </span><span class="identifier-syntax">FALSE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">holons_trimmed_above</span><span class="plain-syntax"> = </span><span class="identifier-syntax">FALSE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">holons_trimmed_below</span><span class="plain-syntax"> = </span><span class="identifier-syntax">FALSE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">i</span><span class="plain-syntax">=0; </span><span class="identifier-syntax">i</span><span class="plain-syntax">&lt;</span><span class="identifier-syntax">NO_DEFINED_NTNMARKER_VALUES</span><span class="plain-syntax">; </span><span class="identifier-syntax">i</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">left_marker</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">] = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">right_marker</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">] = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">main_classifier</span><span class="plain-syntax"> = </span><a href="2-lc2.html#SP1" class="function-link"><span class="function-syntax">LineClassifiers::new</span></a><span class="plain-syntax">();</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">i</span><span class="plain-syntax">=0; </span><span class="identifier-syntax">i</span><span class="plain-syntax">&lt;</span><span class="identifier-syntax">NO_DEFINED_LSNROID_VALUES</span><span class="plain-syntax">; </span><span class="identifier-syntax">i</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">residue_classifier</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">] = </span><a href="2-lc2.html#SP1" class="function-link"><span class="function-syntax">LineClassifiers::new</span></a><span class="plain-syntax">();</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">options_classifier</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">] = </span><a href="2-lc2.html#SP1" class="function-link"><span class="function-syntax">LineClassifiers::new</span></a><span class="plain-syntax">();</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">indexing_machine</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">preprocessor</span><span class="plain-syntax"> = </span><a href="2-wn.html#SP16" class="function-link"><span class="function-syntax">WebNotation::new_machine</span></a><span class="plain-syntax">();</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">postprocessor</span><span class="plain-syntax"> = </span><a href="2-wn.html#SP16" class="function-link"><span class="function-syntax">WebNotation::new_machine</span></a><span class="plain-syntax">();</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">code_preprocessor</span><span class="plain-syntax"> = </span><a href="2-wn.html#SP16" class="function-link"><span class="function-syntax">WebNotation::new_machine</span></a><span class="plain-syntax">();</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">code_postprocessor</span><span class="plain-syntax"> = </span><a href="2-wn.html#SP16" class="function-link"><span class="function-syntax">WebNotation::new_machine</span></a><span class="plain-syntax">();</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">commentary_preprocessor</span><span class="plain-syntax"> = </span><a href="2-wn.html#SP16" class="function-link"><span class="function-syntax">WebNotation::new_machine</span></a><span class="plain-syntax">();</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">commentary_postprocessor</span><span class="plain-syntax"> = </span><a href="2-wn.html#SP16" class="function-link"><span class="function-syntax">WebNotation::new_machine</span></a><span class="plain-syntax">();</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">c_stanza</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">p_stanza</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP3" class="paragraph-anchor"></a><b>&#167;3. Identification.</b>  Notations are named Inweb resources, so to find a notation with a given name,
we hand over to the usual resource resolution code.</p>
<p>For historical reasons, <code>InwebClassic</code> used to be called web syntax version 2,
which is why &quot;2&quot; is read here as if it were &quot;InwebClassic&quot;.</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="function-syntax">WebNotation::notation_by_name</span><button class="popup" onclick="togglePopup('usagePopup2')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup2">Usage of <span class="code-font"><span class="function-syntax">WebNotation::notation_by_name</span></span>:<br/>Web Contents Pages - <a href="1-wcp.html#SP3_1">&#167;3.1</a><br/>Single-File Webs - <a href="1-sw.html#SP3_1">&#167;3.1</a></span></button><span class="plain-syntax">(</span><span class="type-syntax">ls_web</span><span class="plain-syntax"> *</span><span class="identifier-syntax">W</span><span class="plain-syntax">, </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">name</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::eq</span><span class="plain-syntax">(</span><span class="identifier-syntax">name</span><span class="plain-syntax">, </span><span class="identifier-syntax">I</span><span class="string-syntax">"2"</span><span class="plain-syntax">)) </span><span class="identifier-syntax">name</span><span class="plain-syntax"> = </span><span class="identifier-syntax">I</span><span class="string-syntax">"InwebClassic"</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="type-syntax">wcl_declaration</span><span class="plain-syntax"> *</span><span class="identifier-syntax">X</span><span class="plain-syntax"> = </span><a href="1-wcl.html#SP19" class="function-link"><span class="function-syntax">WCL::resolve_resource</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">W</span><span class="plain-syntax">?(</span><span class="identifier-syntax">W</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">declaration</span><span class="plain-syntax">):</span><span class="identifier-syntax">NULL</span><span class="plain-syntax">, </span><span class="constant-syntax">NOTATION_WCLTYPE</span><span class="plain-syntax">, </span><span class="identifier-syntax">name</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">X</span><span class="plain-syntax">) </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">RETRIEVE_POINTER_ls_notation</span><span class="plain-syntax">(</span><span class="identifier-syntax">X</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">object_declared</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP4" class="paragraph-anchor"></a><b>&#167;4. </b>  Pages inside colony declarations default to <code>MarkdownCode</code>, and all other
webs default to <code>InwebClassic</code>; though in practice other considerations usually
get in before defaults are resorted to. These will almost certainly be found,
since they're supplied with Inweb.</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="function-syntax">WebNotation::default</span><button class="popup" onclick="togglePopup('usagePopup3')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup3">Usage of <span class="code-font"><span class="function-syntax">WebNotation::default</span></span>:<br/>Web Contents Pages - <a href="1-wcp.html#SP1">&#167;1</a><br/>Single-File Webs - <a href="1-sw.html#SP1_1">&#167;1.1</a><br/>The Tangler - <a href="4-tt2.html#SP3">&#167;3</a></span></button><span class="plain-syntax">(</span><span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">embedded</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">embedded</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">static</span><span class="plain-syntax"> </span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">default_embedded_notation</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">default_embedded_notation</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">            </span><span class="type-syntax">wcl_declaration</span><span class="plain-syntax"> *</span><span class="identifier-syntax">D</span><span class="plain-syntax"> = </span><a href="1-wcl.html#SP19" class="function-link"><span class="function-syntax">WCL::resolve_resource</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">NULL</span><span class="plain-syntax">, </span><span class="constant-syntax">NOTATION_WCLTYPE</span><span class="plain-syntax">, </span><span class="identifier-syntax">I</span><span class="string-syntax">"MarkdownCode"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">D</span><span class="plain-syntax">) </span><span class="identifier-syntax">default_embedded_notation</span><span class="plain-syntax"> = </span><span class="identifier-syntax">RETRIEVE_POINTER_ls_notation</span><span class="plain-syntax">(</span><span class="identifier-syntax">D</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">object_declared</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">default_embedded_notation</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">)</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">Errors::fatal</span><span class="plain-syntax">(</span><span class="string-syntax">"Unable to locate notation 'MarkdownCode' for literate programs"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">default_embedded_notation</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">static</span><span class="plain-syntax"> </span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">default_ls_notation</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">default_ls_notation</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">            </span><span class="type-syntax">wcl_declaration</span><span class="plain-syntax"> *</span><span class="identifier-syntax">D</span><span class="plain-syntax"> = </span><a href="1-wcl.html#SP19" class="function-link"><span class="function-syntax">WCL::resolve_resource</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">NULL</span><span class="plain-syntax">, </span><span class="constant-syntax">NOTATION_WCLTYPE</span><span class="plain-syntax">, </span><span class="identifier-syntax">I</span><span class="string-syntax">"InwebClassic"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">D</span><span class="plain-syntax">) </span><span class="identifier-syntax">default_ls_notation</span><span class="plain-syntax"> = </span><span class="identifier-syntax">RETRIEVE_POINTER_ls_notation</span><span class="plain-syntax">(</span><span class="identifier-syntax">D</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">object_declared</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">default_ls_notation</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">)</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">Errors::fatal</span><span class="plain-syntax">(</span><span class="string-syntax">"Unable to locate notation 'InwebClassic' for literate programs"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">default_ls_notation</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">}</span>

<span class="type-syntax">void</span><span class="plain-syntax"> </span><span class="function-syntax">WebNotation::write_known_notations</span><span class="plain-syntax">(</span><span class="identifier-syntax">OUTPUT_STREAM</span><span class="plain-syntax">, </span><span class="type-syntax">ls_web</span><span class="plain-syntax"> *</span><span class="identifier-syntax">W</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">WRITE</span><span class="plain-syntax">(</span><span class="string-syntax">"I can see the following literate programming notations:\n\n"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><a href="1-wcl.html#SP22" class="function-link"><span class="function-syntax">WCL::write_sorted_list_of_resources</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">OUT</span><span class="plain-syntax">, </span><span class="identifier-syntax">W</span><span class="plain-syntax">, </span><span class="constant-syntax">NOTATION_WCLTYPE</span><span class="plain-syntax">);</span>
<span class="plain-syntax">}</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP5" class="paragraph-anchor"></a><b>&#167;5. </b>  Here we take a guess from a filename:</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="function-syntax">WebNotation::guess_from_filename</span><button class="popup" onclick="togglePopup('usagePopup4')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup4">Usage of <span class="code-font"><span class="function-syntax">WebNotation::guess_from_filename</span></span>:<br/>Single-File Webs - <a href="1-sw.html#SP1_1">&#167;1.1</a></span></button><span class="plain-syntax">(</span><span class="type-syntax">ls_web</span><span class="plain-syntax"> *</span><span class="identifier-syntax">W</span><span class="plain-syntax">, </span><span class="identifier-syntax">filename</span><span class="plain-syntax"> *</span><span class="identifier-syntax">F</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">TEMPORARY_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">extension</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">TEMPORARY_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">penultimate_extension</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">Filenames::write_final_extension</span><span class="plain-syntax">(</span><span class="identifier-syntax">extension</span><span class="plain-syntax">, </span><span class="identifier-syntax">F</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">Filenames::write_penultimate_extension</span><span class="plain-syntax">(</span><span class="identifier-syntax">penultimate_extension</span><span class="plain-syntax">, </span><span class="identifier-syntax">F</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">result</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">linked_list</span><span class="plain-syntax"> *</span><span class="identifier-syntax">L</span><span class="plain-syntax"> = </span><a href="1-wcl.html#SP20" class="function-link"><span class="function-syntax">WCL::list_resources</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">W</span><span class="plain-syntax">?(</span><span class="identifier-syntax">W</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">declaration</span><span class="plain-syntax">):</span><span class="identifier-syntax">NULL</span><span class="plain-syntax">, </span><span class="constant-syntax">NOTATION_WCLTYPE</span><span class="plain-syntax">, </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="type-syntax">wcl_declaration</span><span class="plain-syntax"> *</span><span class="identifier-syntax">D</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">LOOP_OVER_LINKED_LIST</span><span class="plain-syntax">(</span><span class="identifier-syntax">D</span><span class="plain-syntax">, </span><span class="type-syntax">wcl_declaration</span><span class="plain-syntax">, </span><span class="identifier-syntax">L</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">T</span><span class="plain-syntax"> = </span><span class="identifier-syntax">RETRIEVE_POINTER_ls_notation</span><span class="plain-syntax">(</span><span class="identifier-syntax">D</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">object_declared</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">ext</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">LOOP_OVER_LINKED_LIST</span><span class="plain-syntax">(</span><span class="identifier-syntax">ext</span><span class="plain-syntax">, </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax">, </span><span class="identifier-syntax">T</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">recognised_filename_extensions</span><span class="plain-syntax">)</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::begins_with</span><span class="plain-syntax">(</span><span class="identifier-syntax">ext</span><span class="plain-syntax">, </span><span class="identifier-syntax">I</span><span class="string-syntax">".*."</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">                </span><span class="reserved-syntax">if</span><span class="plain-syntax"> ((</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">penultimate_extension</span><span class="plain-syntax">) &gt; </span><span class="constant-syntax">0</span><span class="plain-syntax">) &amp;&amp; (</span><span class="identifier-syntax">Str::ends_with</span><span class="plain-syntax">(</span><span class="identifier-syntax">ext</span><span class="plain-syntax">, </span><span class="identifier-syntax">extension</span><span class="plain-syntax">))) {</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">result</span><span class="plain-syntax"> = </span><span class="identifier-syntax">T</span><span class="plain-syntax">;</span>
<span class="plain-syntax">                    </span><span class="reserved-syntax">goto</span><span class="plain-syntax"> </span><span class="identifier-syntax">DoubleBreak</span><span class="plain-syntax">;</span>
<span class="plain-syntax">                }</span>
<span class="plain-syntax">            } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::eq_insensitive</span><span class="plain-syntax">(</span><span class="identifier-syntax">ext</span><span class="plain-syntax">, </span><span class="identifier-syntax">extension</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">result</span><span class="plain-syntax"> = </span><span class="identifier-syntax">T</span><span class="plain-syntax">;</span>
<span class="plain-syntax">                </span><span class="reserved-syntax">goto</span><span class="plain-syntax"> </span><span class="identifier-syntax">DoubleBreak</span><span class="plain-syntax">;</span>
<span class="plain-syntax">            }</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">DoubleBreak:</span><span class="plain-syntax"> ;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">DISCARD_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">penultimate_extension</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">DISCARD_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">extension</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">result</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP6" class="paragraph-anchor"></a><b>&#167;6. Adoption and adaptation to conventions.</b>  Suppose, then, that the above methods decide that a given web <code>W</code> should be read
with notation <code>ntn</code>. What happens then?</p>
<p>Not much, right away: we simply set the `Notation` metadata.</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="type-syntax">void</span><span class="plain-syntax"> </span><span class="function-syntax">WebNotation::adopt_for_web</span><button class="popup" onclick="togglePopup('usagePopup5')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup5">Usage of <span class="code-font"><span class="function-syntax">WebNotation::adopt_for_web</span></span>:<br/>Web Contents Pages - <a href="1-wcp.html#SP1">&#167;1</a>, <a href="1-wcp.html#SP3_1">&#167;3.1</a>, <a href="1-wcp.html#SP3_2_1_2">&#167;3.2.1.2</a><br/>Single-File Webs - <a href="1-sw.html#SP1">&#167;1</a>, <a href="1-sw.html#SP1_3">&#167;1.3</a></span></button><span class="plain-syntax">(</span><span class="type-syntax">ls_web</span><span class="plain-syntax"> *</span><span class="identifier-syntax">W</span><span class="plain-syntax">, </span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">W</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">web_notation</span><span class="plain-syntax"> != </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">W</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">web_notation</span><span class="plain-syntax"> = </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">) </span><a href="1-bdfw.html#SP7" class="function-link"><span class="function-syntax">Bibliographic::set_datum</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">W</span><span class="plain-syntax">, </span><span class="identifier-syntax">I</span><span class="string-syntax">"Notation"</span><span class="plain-syntax">, </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">name</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">}</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP7" class="paragraph-anchor"></a><b>&#167;7. </b>  The <code>ls_notation</code> is not immutable once created, because it needs to be
tinkered with each time is used with a given web. The reason for this is that
each web has its own conventions, and those override some of the syntaxes
in the notation (or might do). So the following is called whenever a
notation needs to be used in the context of a given set of conventions:</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="type-syntax">void</span><span class="plain-syntax"> </span><span class="function-syntax">WebNotation::adapt_to_conventions</span><button class="popup" onclick="togglePopup('usagePopup6')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup6">Usage of <span class="code-font"><span class="function-syntax">WebNotation::adapt_to_conventions</span></span>:<br/>Web Structure - <a href="1-ws.html#SP2">&#167;2</a></span></button><span class="plain-syntax">(</span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">, </span><span class="identifier-syntax">linked_list</span><span class="plain-syntax"> *</span><span class="identifier-syntax">C</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><a href="2-wn.html#SP8" class="function-link"><span class="function-syntax">WebNotation::set_markers</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">, </span><span class="constant-syntax">NAMED_HOLONS_NTNMARKER</span><span class="plain-syntax">,</span>
<span class="plain-syntax">        </span><a href="1-cnv.html#SP9" class="function-link"><span class="function-syntax">Conventions::get_textual_from</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">C</span><span class="plain-syntax">, </span><span class="constant-syntax">HOLON_NAME_SYNTAX_LSCONVENTION</span><span class="plain-syntax">),</span>
<span class="plain-syntax">        </span><a href="1-cnv.html#SP9" class="function-link"><span class="function-syntax">Conventions::get_textual2_from</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">C</span><span class="plain-syntax">, </span><span class="constant-syntax">HOLON_NAME_SYNTAX_LSCONVENTION</span><span class="plain-syntax">));</span>
<span class="plain-syntax">    </span><a href="2-wn.html#SP8" class="function-link"><span class="function-syntax">WebNotation::set_markers</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">, </span><span class="constant-syntax">FILE_NAMED_HOLONS_NTNMARKER</span><span class="plain-syntax">,</span>
<span class="plain-syntax">        </span><a href="1-cnv.html#SP9" class="function-link"><span class="function-syntax">Conventions::get_textual_from</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">C</span><span class="plain-syntax">, </span><span class="constant-syntax">FILE_HOLON_NAME_SYNTAX_LSCONVENTION</span><span class="plain-syntax">),</span>
<span class="plain-syntax">        </span><a href="1-cnv.html#SP9" class="function-link"><span class="function-syntax">Conventions::get_textual2_from</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">C</span><span class="plain-syntax">, </span><span class="constant-syntax">FILE_HOLON_NAME_SYNTAX_LSCONVENTION</span><span class="plain-syntax">));</span>
<span class="plain-syntax">    </span><a href="2-wn.html#SP8" class="function-link"><span class="function-syntax">WebNotation::set_markers</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">, </span><span class="constant-syntax">VERBATIM_CODE_NTNMARKER</span><span class="plain-syntax">,</span>
<span class="plain-syntax">        </span><a href="1-cnv.html#SP9" class="function-link"><span class="function-syntax">Conventions::get_textual_from</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">C</span><span class="plain-syntax">, </span><span class="constant-syntax">VERBATIM_LSCONVENTION</span><span class="plain-syntax">),</span>
<span class="plain-syntax">        </span><a href="1-cnv.html#SP9" class="function-link"><span class="function-syntax">Conventions::get_textual2_from</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">C</span><span class="plain-syntax">, </span><span class="constant-syntax">VERBATIM_LSCONVENTION</span><span class="plain-syntax">));</span>
<span class="plain-syntax">    </span><a href="2-wn.html#SP8" class="function-link"><span class="function-syntax">WebNotation::set_markers</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">, </span><span class="constant-syntax">METADATA_IN_STRINGS_NTNMARKER</span><span class="plain-syntax">,</span>
<span class="plain-syntax">        </span><a href="1-cnv.html#SP9" class="function-link"><span class="function-syntax">Conventions::get_textual_from</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">C</span><span class="plain-syntax">, </span><span class="constant-syntax">METADATA_IN_STRINGS_SYNTAX_LSCONVENTION</span><span class="plain-syntax">),</span>
<span class="plain-syntax">        </span><a href="1-cnv.html#SP9" class="function-link"><span class="function-syntax">Conventions::get_textual2_from</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">C</span><span class="plain-syntax">, </span><span class="constant-syntax">METADATA_IN_STRINGS_SYNTAX_LSCONVENTION</span><span class="plain-syntax">));</span>
<span class="plain-syntax">    </span><a href="2-wn.html#SP8" class="function-link"><span class="function-syntax">WebNotation::set_markers</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">, </span><span class="constant-syntax">PARAGRAPH_TAGS_NTNMARKER</span><span class="plain-syntax">,</span>
<span class="plain-syntax">        </span><a href="1-cnv.html#SP9" class="function-link"><span class="function-syntax">Conventions::get_textual_from</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">C</span><span class="plain-syntax">, </span><span class="constant-syntax">TAGS_SYNTAX_LSCONVENTION</span><span class="plain-syntax">),</span>
<span class="plain-syntax">        </span><a href="1-cnv.html#SP9" class="function-link"><span class="function-syntax">Conventions::get_textual2_from</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">C</span><span class="plain-syntax">, </span><span class="constant-syntax">TAGS_SYNTAX_LSCONVENTION</span><span class="plain-syntax">));</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">footnotes_in_commentary</span><span class="plain-syntax"> =</span>
<span class="plain-syntax">        </span><a href="1-cnv.html#SP9" class="function-link"><span class="function-syntax">Conventions::get_int_from</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">C</span><span class="plain-syntax">, </span><span class="constant-syntax">FOOTNOTES_LSCONVENTION</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">holons_trimmed_above</span><span class="plain-syntax"> =</span>
<span class="plain-syntax">        </span><a href="1-cnv.html#SP9" class="function-link"><span class="function-syntax">Conventions::get_int_from</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">C</span><span class="plain-syntax">, </span><span class="constant-syntax">HOLONS_ARE_TRIMMED_ABOVE_LSCONVENTION</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">holons_trimmed_below</span><span class="plain-syntax"> =</span>
<span class="plain-syntax">        </span><a href="1-cnv.html#SP9" class="function-link"><span class="function-syntax">Conventions::get_int_from</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">C</span><span class="plain-syntax">, </span><span class="constant-syntax">HOLONS_ARE_TRIMMED_BELOW_LSCONVENTION</span><span class="plain-syntax">);</span>

<span class="plain-syntax">    </span><a href="2-lc2.html#SP4" class="function-link"><span class="function-syntax">LineClassifiers::reparse_patterns_with_new_conventions</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">main_classifier</span><span class="plain-syntax">, </span><span class="identifier-syntax">C</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">i</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">; </span><span class="identifier-syntax">i</span><span class="plain-syntax"> &lt; </span><span class="identifier-syntax">NO_DEFINED_LSNROID_VALUES</span><span class="plain-syntax">; </span><span class="identifier-syntax">i</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">residue_classifier</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">])</span>
<span class="plain-syntax">            </span><a href="2-lc2.html#SP4" class="function-link"><span class="function-syntax">LineClassifiers::reparse_patterns_with_new_conventions</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">residue_classifier</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">], </span><span class="identifier-syntax">C</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">options_classifier</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">])</span>
<span class="plain-syntax">            </span><a href="2-lc2.html#SP4" class="function-link"><span class="function-syntax">LineClassifiers::reparse_patterns_with_new_conventions</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">options_classifier</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">], </span><span class="identifier-syntax">C</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">indexing_machine</span><span class="plain-syntax"> = </span><a href="2-wi.html#SP1" class="function-link"><span class="function-syntax">WebIndexing::make_indexing_machine</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">C</span><span class="plain-syntax">);</span>
<span class="plain-syntax">}</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP8" class="paragraph-anchor"></a><b>&#167;8. Notation markers.</b>  These are textual markers occurring inside code or commentary, but not at
convenient line boundaries, such as the &quot;{{&quot; and &quot;}}&quot; used to mark named
holons in <code>MarkdownCode</code>. As it turns out, the ones we need all occur in
left/right pairs.</p>
</div>
<pre class="definitions code-font"><span class="definition-keyword">enumerate</span> <span class="identifier-syntax">NAMED_HOLONS_NTNMARKER</span> <span class="constant-syntax">0</span><span class="plain-syntax">          </span><span class="comment-syntax">/* notation for holon names */</span>
</pre>
<pre class="definitions code-font"><span class="definition-keyword">enumerate</span> <span class="identifier-syntax">FILE_NAMED_HOLONS_NTNMARKER</span> <span class="comment-syntax">/* notation for file holon names */</span><span class="plain-syntax"> </span>
</pre>
<pre class="definitions code-font"><span class="definition-keyword">enumerate</span> <span class="identifier-syntax">VERBATIM_CODE_NTNMARKER</span> <span class="comment-syntax">/* notation for verbatim tangle matter */</span><span class="plain-syntax"> </span>
</pre>
<pre class="definitions code-font"><span class="definition-keyword">enumerate</span> <span class="identifier-syntax">METADATA_IN_STRINGS_NTNMARKER</span> <span class="comment-syntax">/* notation for metadata in strings */</span><span class="plain-syntax"> </span>
</pre>
<pre class="definitions code-font"><span class="definition-keyword">enumerate</span> <span class="identifier-syntax">PARAGRAPH_TAGS_NTNMARKER</span> <span class="comment-syntax">/* paragraphs can be tagged */</span><span class="plain-syntax"> </span>
</pre>
<pre class="displayed-code all-displayed-code code-font">
<span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="function-syntax">WebNotation::left</span><button class="popup" onclick="togglePopup('usagePopup7')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup7">Usage of <span class="code-font"><span class="function-syntax">WebNotation::left</span></span>:<br/>Holon Syntax - <a href="2-hs.html#SP1_1_2">&#167;1.1.2</a>, <a href="2-hs.html#SP1_1_6">&#167;1.1.6</a><br/>Code Excerpts - <a href="2-ce.html#SP5_1_1">&#167;5.1.1</a><br/>The Tangler - <a href="4-tt2.html#SP12_1_2">&#167;12.1.2</a>, <a href="4-tt2.html#SP15">&#167;15</a></span></button><span class="plain-syntax">(</span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">, </span><span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">feature</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> ((</span><span class="identifier-syntax">feature</span><span class="plain-syntax"> &lt; </span><span class="constant-syntax">0</span><span class="plain-syntax">) || (</span><span class="identifier-syntax">feature</span><span class="plain-syntax"> &gt;= </span><span class="identifier-syntax">NO_DEFINED_NTNMARKER_VALUES</span><span class="plain-syntax">))</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">internal_error</span><span class="plain-syntax">(</span><span class="string-syntax">"feature out of range"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">left_marker</span><span class="plain-syntax">[</span><span class="identifier-syntax">feature</span><span class="plain-syntax">];</span>
<span class="plain-syntax">}</span>

<span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="function-syntax">WebNotation::right</span><button class="popup" onclick="togglePopup('usagePopup8')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup8">Usage of <span class="code-font"><span class="function-syntax">WebNotation::right</span></span>:<br/>Holon Syntax - <a href="2-hs.html#SP1_1_2">&#167;1.1.2</a>, <a href="2-hs.html#SP1_1_6">&#167;1.1.6</a><br/>Code Excerpts - <a href="2-ce.html#SP5_1_1">&#167;5.1.1</a><br/>The Tangler - <a href="4-tt2.html#SP12_1_2">&#167;12.1.2</a>, <a href="4-tt2.html#SP15">&#167;15</a></span></button><span class="plain-syntax">(</span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">, </span><span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">feature</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> ((</span><span class="identifier-syntax">feature</span><span class="plain-syntax"> &lt; </span><span class="constant-syntax">0</span><span class="plain-syntax">) || (</span><span class="identifier-syntax">feature</span><span class="plain-syntax"> &gt;= </span><span class="identifier-syntax">NO_DEFINED_NTNMARKER_VALUES</span><span class="plain-syntax">))</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">internal_error</span><span class="plain-syntax">(</span><span class="string-syntax">"feature out of range"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">right_marker</span><span class="plain-syntax">[</span><span class="identifier-syntax">feature</span><span class="plain-syntax">];</span>
<span class="plain-syntax">}</span>

<span class="type-syntax">void</span><span class="plain-syntax"> </span><span class="function-syntax">WebNotation::set_markers</span><button class="popup" onclick="togglePopup('usagePopup9')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup9">Usage of <span class="code-font"><span class="function-syntax">WebNotation::set_markers</span></span>:<br/><a href="2-wn.html#SP7">&#167;7</a></span></button><span class="plain-syntax">(</span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">, </span><span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">feature</span><span class="plain-syntax">, </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">left</span><span class="plain-syntax">, </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">right</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">left_marker</span><span class="plain-syntax">[</span><span class="identifier-syntax">feature</span><span class="plain-syntax">] = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">left</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">right_marker</span><span class="plain-syntax">[</span><span class="identifier-syntax">feature</span><span class="plain-syntax">] = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">right</span><span class="plain-syntax">);</span>
<span class="plain-syntax">}</span>

<span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="function-syntax">WebNotation::has_nonempty_markers</span><span class="plain-syntax">(</span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">, </span><span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">feature</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> ((</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">left_marker</span><span class="plain-syntax">[</span><span class="identifier-syntax">feature</span><span class="plain-syntax">]) &gt; </span><span class="constant-syntax">0</span><span class="plain-syntax">) &amp;&amp;</span>
<span class="plain-syntax">        (</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">right_marker</span><span class="plain-syntax">[</span><span class="identifier-syntax">feature</span><span class="plain-syntax">]) &gt; </span><span class="constant-syntax">0</span><span class="plain-syntax">)) </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">TRUE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">FALSE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>

<span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="function-syntax">WebNotation::supports_named_holons</span><button class="popup" onclick="togglePopup('usagePopup10')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup10">Usage of <span class="code-font"><span class="function-syntax">WebNotation::supports_named_holons</span></span>:<br/>Holon Syntax - <a href="2-hs.html#SP1_1_2">&#167;1.1.2</a></span></button><span class="plain-syntax">(</span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><a href="2-wn.html#SP8" class="function-link"><span class="function-syntax">WebNotation::has_nonempty_markers</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">, </span><span class="constant-syntax">NAMED_HOLONS_NTNMARKER</span><span class="plain-syntax">);</span>
<span class="plain-syntax">}</span>

<span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="function-syntax">WebNotation::supports_verbatim_material</span><button class="popup" onclick="togglePopup('usagePopup11')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup11">Usage of <span class="code-font"><span class="function-syntax">WebNotation::supports_verbatim_material</span></span>:<br/>Holon Syntax - <a href="2-hs.html#SP1_1_2">&#167;1.1.2</a></span></button><span class="plain-syntax">(</span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><a href="2-wn.html#SP8" class="function-link"><span class="function-syntax">WebNotation::has_nonempty_markers</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">, </span><span class="constant-syntax">VERBATIM_CODE_NTNMARKER</span><span class="plain-syntax">);</span>
<span class="plain-syntax">}</span>

<span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="function-syntax">WebNotation::supports_file_named_holons</span><button class="popup" onclick="togglePopup('usagePopup12')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup12">Usage of <span class="code-font"><span class="function-syntax">WebNotation::supports_file_named_holons</span></span>:<br/>Holon Syntax - <a href="2-hs.html#SP1_1_2">&#167;1.1.2</a></span></button><span class="plain-syntax">(</span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><a href="2-wn.html#SP8" class="function-link"><span class="function-syntax">WebNotation::has_nonempty_markers</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">, </span><span class="constant-syntax">FILE_NAMED_HOLONS_NTNMARKER</span><span class="plain-syntax">);</span>
<span class="plain-syntax">}</span>

<span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="function-syntax">WebNotation::supports_metadata_in_strings</span><button class="popup" onclick="togglePopup('usagePopup13')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup13">Usage of <span class="code-font"><span class="function-syntax">WebNotation::supports_metadata_in_strings</span></span>:<br/>Holon Syntax - <a href="2-hs.html#SP1_1_6">&#167;1.1.6</a></span></button><span class="plain-syntax">(</span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><a href="2-wn.html#SP8" class="function-link"><span class="function-syntax">WebNotation::has_nonempty_markers</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">, </span><span class="constant-syntax">METADATA_IN_STRINGS_NTNMARKER</span><span class="plain-syntax">);</span>
<span class="plain-syntax">}</span>

<span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="function-syntax">WebNotation::supports_paragraph_tags</span><button class="popup" onclick="togglePopup('usagePopup14')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup14">Usage of <span class="code-font"><span class="function-syntax">WebNotation::supports_paragraph_tags</span></span>:<br/>Line Classifiers - <a href="2-lc2.html#SP8">&#167;8</a></span></button><span class="plain-syntax">(</span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><a href="2-wn.html#SP8" class="function-link"><span class="function-syntax">WebNotation::has_nonempty_markers</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">, </span><span class="constant-syntax">PARAGRAPH_TAGS_NTNMARKER</span><span class="plain-syntax">);</span>
<span class="plain-syntax">}</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP9" class="paragraph-anchor"></a><b>&#167;9. Commentary markup.</b>  This is entirely decided by conventions, which is why it isn't explicitly
visible in the <code>ls_notation</code> structure. If a notation's declaration says
that commentary uses Markdown, for example, that will be part of the
<code>Conventions</code> resource which is a child of the notation declaration.</p>
<p>So in a sense the following pair of functions don't belong here, since they
don't use any part of the <code>ls_notation</code>. On the other hand, they're clearly
notational...</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="function-syntax">WebNotation::commentary_markup</span><span class="plain-syntax">(</span><span class="type-syntax">ls_web</span><span class="plain-syntax"> *</span><span class="identifier-syntax">W</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">W</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="constant-syntax">SIMPLIFIED_COMMENTARY_MARKUPCHOICE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><a href="1-cnv.html#SP10" class="function-link"><span class="function-syntax">Conventions::get_int</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">W</span><span class="plain-syntax">, </span><span class="constant-syntax">COMMENTARY_MARKUP_LSCONVENTION</span><span class="plain-syntax">);</span>
<span class="plain-syntax">}</span>

<span class="identifier-syntax">markdown_variation</span><span class="plain-syntax"> *</span><span class="function-syntax">WebNotation::commentary_variation</span><button class="popup" onclick="togglePopup('usagePopup15')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup15">Usage of <span class="code-font"><span class="function-syntax">WebNotation::commentary_variation</span></span>:<br/>Web Structure - <a href="1-ws.html#SP3">&#167;3</a><br/>The Weaver - <a href="5-tw.html#SP2_6_3_1">&#167;2.6.3.1</a>, <a href="5-tw.html#SP2_6_3_2">&#167;2.6.3.2</a>, <a href="5-tw.html#SP4_1_1">&#167;4.1.1</a>, <a href="5-tw.html#SP4_1_5">&#167;4.1.5</a></span></button><span class="plain-syntax">(</span><span class="type-syntax">ls_web</span><span class="plain-syntax"> *</span><span class="identifier-syntax">W</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">markup</span><span class="plain-syntax"> = </span><a href="2-wn.html#SP9" class="function-link"><span class="function-syntax">WebNotation::commentary_markup</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">W</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">switch</span><span class="plain-syntax"> (</span><span class="identifier-syntax">markup</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">SIMPLIFIED_COMMENTARY_MARKUPCHOICE:</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">MarkdownVariations::simplified_Inweb_flavoured_Markdown</span><span class="plain-syntax">();</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">MARKDOWN_COMMENTARY_MARKUPCHOICE:</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">MarkdownVariations::Inweb_flavoured_Markdown</span><span class="plain-syntax">();</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">TEX_COMMENTARY_MARKUPCHOICE:</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">MarkdownVariations::TeX_flavoured_Markdown</span><span class="plain-syntax">();</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">internal_error</span><span class="plain-syntax">(</span><span class="string-syntax">"unsupported commentary variation"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">}</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP10" class="paragraph-anchor"></a><b>&#167;10. Reading notation definitions.</b>  We can read in a whole directory of these...</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="type-syntax">void</span><span class="plain-syntax"> </span><span class="function-syntax">WebNotation::read_definitions</span><span class="plain-syntax">(</span><span class="identifier-syntax">pathname</span><span class="plain-syntax"> *</span><span class="identifier-syntax">P</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">scan_directory</span><span class="plain-syntax"> *</span><span class="identifier-syntax">D</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Directories::open</span><span class="plain-syntax">(</span><span class="identifier-syntax">P</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">TEMPORARY_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">leafname</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">while</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Directories::next</span><span class="plain-syntax">(</span><span class="identifier-syntax">D</span><span class="plain-syntax">, </span><span class="identifier-syntax">leafname</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Platform::is_folder_separator</span><span class="plain-syntax">(</span><span class="identifier-syntax">Str::get_last_char</span><span class="plain-syntax">(</span><span class="identifier-syntax">leafname</span><span class="plain-syntax">)) == </span><span class="identifier-syntax">FALSE</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">filename</span><span class="plain-syntax"> *</span><span class="identifier-syntax">F</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Filenames::in</span><span class="plain-syntax">(</span><span class="identifier-syntax">P</span><span class="plain-syntax">, </span><span class="identifier-syntax">leafname</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><a href="2-wn.html#SP11" class="function-link"><span class="function-syntax">WebNotation::read_definition</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">F</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">DISCARD_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">leafname</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">Directories::close</span><span class="plain-syntax">(</span><span class="identifier-syntax">D</span><span class="plain-syntax">);</span>
<span class="plain-syntax">}</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP11" class="paragraph-anchor"></a><b>&#167;11. </b>  ...or just a single file...</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="function-syntax">WebNotation::read_definition</span><button class="popup" onclick="togglePopup('usagePopup16')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup16">Usage of <span class="code-font"><span class="function-syntax">WebNotation::read_definition</span></span>:<br/><a href="2-wn.html#SP10">&#167;10</a></span></button><span class="plain-syntax">(</span><span class="identifier-syntax">filename</span><span class="plain-syntax"> *</span><span class="identifier-syntax">F</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="type-syntax">wcl_declaration</span><span class="plain-syntax"> *</span><span class="identifier-syntax">D</span><span class="plain-syntax"> = </span><a href="1-wcl.html#SP27" class="function-link"><span class="function-syntax">WCL::read_just_one</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">F</span><span class="plain-syntax">, </span><span class="constant-syntax">NOTATION_WCLTYPE</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">D</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">RETRIEVE_POINTER_ls_notation</span><span class="plain-syntax">(</span><span class="identifier-syntax">D</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">object_declared</span><span class="plain-syntax">);</span>
<span class="plain-syntax">}</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP12" class="paragraph-anchor"></a><b>&#167;12. </b>  And notations can also arise as resources nested inside other WCL resources,
such as webs or colonies. In all these cases, though, we end up having to
parse the lines of a WCL declaration for the notation, as follows.</p>
<p>There is a possibly unnecessary little dance here to deal with notations
which have no explicit name: it's unclear whether we should even support those,
but for what it's worth, we call them <code>NamelessNotation</code>, <code>NamelessNotation2</code>,
..., in order of discovery.</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="function-syntax">WebNotation::parse_declaration</span><button class="popup" onclick="togglePopup('usagePopup17')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup17">Usage of <span class="code-font"><span class="function-syntax">WebNotation::parse_declaration</span></span>:<br/>Web Control Language - <a href="1-wcl.html#SP13">&#167;13</a></span></button><span class="plain-syntax">(</span><span class="type-syntax">wcl_declaration</span><span class="plain-syntax"> *</span><span class="identifier-syntax">D</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">ntn</span><span class="plain-syntax"> = </span><a href="2-wn.html#SP2" class="function-link"><span class="function-syntax">WebNotation::new</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">I</span><span class="string-syntax">"_pending_naming_only"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">declaration</span><span class="plain-syntax"> = </span><span class="identifier-syntax">D</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP12_1" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Parse lines of the declaration</span></span><span class="named-paragraph-number">12.1</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">D</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">object_declared</span><span class="plain-syntax"> = </span><span class="identifier-syntax">STORE_POINTER_ls_notation</span><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::eq</span><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">name</span><span class="plain-syntax">, </span><span class="identifier-syntax">I</span><span class="string-syntax">"_pending_naming_only"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">name</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">D</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">name</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">name</span><span class="plain-syntax">) == </span><span class="constant-syntax">0</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">static</span><span class="plain-syntax"> </span><span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">nameless_notations</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">;</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">nameless_notations</span><span class="plain-syntax">++;</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">Str::clear</span><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">name</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">WRITE_TO</span><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">name</span><span class="plain-syntax">, </span><span class="string-syntax">"NamelessNotation"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">nameless_notations</span><span class="plain-syntax"> &gt; </span><span class="constant-syntax">1</span><span class="plain-syntax">) </span><span class="identifier-syntax">WRITE_TO</span><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">name</span><span class="plain-syntax">, </span><span class="string-syntax">"%d"</span><span class="plain-syntax">, </span><span class="identifier-syntax">nameless_notations</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">    } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><a href="1-wcl.html#SP9" class="function-link"><span class="function-syntax">WCL::check_name</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">D</span><span class="plain-syntax">, </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">name</span><span class="plain-syntax">) == </span><span class="identifier-syntax">FALSE</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">TEMPORARY_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">msg</span><span class="plain-syntax">)</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">WRITE_TO</span><span class="plain-syntax">(</span><span class="identifier-syntax">msg</span><span class="plain-syntax">, </span><span class="string-syntax">"language has two different names, '%S' and '%S'"</span><span class="plain-syntax">,</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">D</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">name</span><span class="plain-syntax">, </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">name</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><a href="1-wcl.html#SP6" class="function-link"><span class="function-syntax">WCL::error</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">D</span><span class="plain-syntax">, &amp;(</span><span class="identifier-syntax">D</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">declaration_position</span><span class="plain-syntax">), </span><span class="identifier-syntax">msg</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">DISCARD_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">msg</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>
</pre>
<p class="commentary firstcommentary"><a id="SP12_1" class="paragraph-anchor"></a><b>&#167;12.1. </b> <span class="named-paragraph-container code-font"><span class="named-paragraph-defn">Parse lines of the declaration</span><span class="named-paragraph-number">12.1</span></span> =</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    </span><span class="identifier-syntax">text_file_position</span><span class="plain-syntax"> </span><span class="identifier-syntax">tfp</span><span class="plain-syntax"> = </span><span class="identifier-syntax">D</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">body_position</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">L</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">LOOP_OVER_LINKED_LIST</span><span class="plain-syntax">(</span><span class="identifier-syntax">L</span><span class="plain-syntax">, </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax">, </span><span class="identifier-syntax">D</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">declaration_lines</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">TEMPORARY_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">line</span><span class="plain-syntax">)</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">Str::copy</span><span class="plain-syntax">(</span><span class="identifier-syntax">line</span><span class="plain-syntax">, </span><span class="identifier-syntax">L</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><a href="2-wn.html#SP13" class="function-link"><span class="function-syntax">WebNotation::read_definition_line</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">line</span><span class="plain-syntax">, &amp;</span><span class="identifier-syntax">tfp</span><span class="plain-syntax">, (</span><span class="type-syntax">void</span><span class="plain-syntax"> *) </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">DISCARD_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">line</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">tfp</span><span class="plain-syntax">.</span><span class="element-syntax">line_count</span><span class="plain-syntax">++;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> ((</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">c_stanza</span><span class="plain-syntax">) || (</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">p_stanza</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">        </span><a href="1-wcl.html#SP6" class="function-link"><span class="function-syntax">WCL::error</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">declaration</span><span class="plain-syntax">, &amp;</span><span class="identifier-syntax">tfp</span><span class="plain-syntax">, </span><span class="identifier-syntax">I</span><span class="string-syntax">"notation ended without 'end'"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    }</span>
</pre>
<ul class="endnotetexts"><li>This code is used in <a href="2-wn.html#SP12">&#167;12</a>.</li></ul>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP13" class="paragraph-anchor"></a><b>&#167;13. </b>  Each line of the declaration funnels in turn through this function:</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="type-syntax">void</span><span class="plain-syntax"> </span><span class="function-syntax">WebNotation::read_definition_line</span><button class="popup" onclick="togglePopup('usagePopup18')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup18">Usage of <span class="code-font"><span class="function-syntax">WebNotation::read_definition_line</span></span>:<br/><a href="2-wn.html#SP12_1">&#167;12.1</a></span></button><span class="plain-syntax">(</span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">line</span><span class="plain-syntax">, </span><span class="identifier-syntax">text_file_position</span><span class="plain-syntax"> *</span><span class="identifier-syntax">tfp</span><span class="plain-syntax">, </span><span class="type-syntax">void</span><span class="plain-syntax"> *</span><span class="identifier-syntax">v_state</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">ntn</span><span class="plain-syntax"> = (</span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *) </span><span class="identifier-syntax">v_state</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">Str::trim_white_space</span><span class="plain-syntax">(</span><span class="identifier-syntax">line</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">error</span><span class="plain-syntax"> = </span><a href="2-wn.html#SP14" class="function-link"><span class="function-syntax">WebNotation::apply_definition_line</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">, </span><span class="identifier-syntax">line</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">error</span><span class="plain-syntax">) &gt; </span><span class="constant-syntax">0</span><span class="plain-syntax">) </span><a href="1-wcl.html#SP6" class="function-link"><span class="function-syntax">WCL::error</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">declaration</span><span class="plain-syntax">, </span><span class="identifier-syntax">tfp</span><span class="plain-syntax">, </span><span class="identifier-syntax">error</span><span class="plain-syntax">);</span>
<span class="plain-syntax">}</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP14" class="paragraph-anchor"></a><b>&#167;14. </b>  The following either acts on a line, or does nothing and returns a non-empty
text which represents an error message.</p>
<p>&quot;Stanzas&quot; are the blocks of lines occurring between, say, <code>classify</code> and <code>end</code>.
Some make changes to classifiers, others to processing machines. If our line
is in a classifier stanza, <code>ntn-&gt;c_stanza</code> is set to that classifier; if in
a processing stanza, similarly for <code>ntn-&gt;p_stanza</code>; and they cannot both be
set at the same time. Stanzas cannot be nested.</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="function-syntax">WebNotation::apply_definition_line</span><button class="popup" onclick="togglePopup('usagePopup19')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup19">Usage of <span class="code-font"><span class="function-syntax">WebNotation::apply_definition_line</span></span>:<br/><a href="2-wn.html#SP13">&#167;13</a></span></button><span class="plain-syntax">(</span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">, </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">cmd</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">error</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">match_results</span><span class="plain-syntax"> </span><span class="identifier-syntax">mr</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Regexp::create_mr</span><span class="plain-syntax">();</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::is_whitespace</span><span class="plain-syntax">(</span><span class="identifier-syntax">cmd</span><span class="plain-syntax">)) </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP14_5" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Setting done</span></span><span class="named-paragraph-number">14.5</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> ((</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">c_stanza</span><span class="plain-syntax">) || (</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">p_stanza</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">        </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP14_4" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Inside stanzas</span></span><span class="named-paragraph-number">14.4</span></a></span>
<span class="plain-syntax">    } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">        </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP14_1" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Entering processor stanzas</span></span><span class="named-paragraph-number">14.1</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP14_2" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Entering classifier stanzas</span></span><span class="named-paragraph-number">14.2</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP14_3" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Miscellaneous settings</span></span><span class="named-paragraph-number">14.3</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">error</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::new</span><span class="plain-syntax">();</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">WRITE_TO</span><span class="plain-syntax">(</span><span class="identifier-syntax">error</span><span class="plain-syntax">, </span><span class="string-syntax">"unknown inweb notation command '%S'"</span><span class="plain-syntax">, </span><span class="identifier-syntax">cmd</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP14_5" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Setting done</span></span><span class="named-paragraph-number">14.5</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>
</pre>
<p class="commentary firstcommentary"><a id="SP14_1" class="paragraph-anchor"></a><b>&#167;14.1. </b> <span class="named-paragraph-container code-font"><span class="named-paragraph-defn">Entering processor stanzas</span><span class="named-paragraph-number">14.1</span></span> =</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Regexp::match</span><span class="plain-syntax">(&amp;</span><span class="identifier-syntax">mr</span><span class="plain-syntax">, </span><span class="identifier-syntax">cmd</span><span class="plain-syntax">, </span><span class="identifier-syntax">U</span><span class="string-syntax">"preprocess"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">p_stanza</span><span class="plain-syntax"> = </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">preprocessor</span><span class="plain-syntax">; </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP14_5" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Setting done</span></span><span class="named-paragraph-number">14.5</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Regexp::match</span><span class="plain-syntax">(&amp;</span><span class="identifier-syntax">mr</span><span class="plain-syntax">, </span><span class="identifier-syntax">cmd</span><span class="plain-syntax">, </span><span class="identifier-syntax">U</span><span class="string-syntax">"postprocess"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">p_stanza</span><span class="plain-syntax"> = </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">postprocessor</span><span class="plain-syntax">; </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP14_5" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Setting done</span></span><span class="named-paragraph-number">14.5</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Regexp::match</span><span class="plain-syntax">(&amp;</span><span class="identifier-syntax">mr</span><span class="plain-syntax">, </span><span class="identifier-syntax">cmd</span><span class="plain-syntax">, </span><span class="identifier-syntax">U</span><span class="string-syntax">"process code"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">p_stanza</span><span class="plain-syntax"> = </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">code_preprocessor</span><span class="plain-syntax">; </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP14_5" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Setting done</span></span><span class="named-paragraph-number">14.5</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Regexp::match</span><span class="plain-syntax">(&amp;</span><span class="identifier-syntax">mr</span><span class="plain-syntax">, </span><span class="identifier-syntax">cmd</span><span class="plain-syntax">, </span><span class="identifier-syntax">U</span><span class="string-syntax">"postprocess code"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">p_stanza</span><span class="plain-syntax"> = </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">code_postprocessor</span><span class="plain-syntax">; </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP14_5" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Setting done</span></span><span class="named-paragraph-number">14.5</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Regexp::match</span><span class="plain-syntax">(&amp;</span><span class="identifier-syntax">mr</span><span class="plain-syntax">, </span><span class="identifier-syntax">cmd</span><span class="plain-syntax">, </span><span class="identifier-syntax">U</span><span class="string-syntax">"process commentary"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">p_stanza</span><span class="plain-syntax"> = </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">commentary_preprocessor</span><span class="plain-syntax">; </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP14_5" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Setting done</span></span><span class="named-paragraph-number">14.5</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Regexp::match</span><span class="plain-syntax">(&amp;</span><span class="identifier-syntax">mr</span><span class="plain-syntax">, </span><span class="identifier-syntax">cmd</span><span class="plain-syntax">, </span><span class="identifier-syntax">U</span><span class="string-syntax">"postprocess commentary"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">p_stanza</span><span class="plain-syntax"> = </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">commentary_postprocessor</span><span class="plain-syntax">; </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP14_5" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Setting done</span></span><span class="named-paragraph-number">14.5</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
</pre>
<ul class="endnotetexts"><li>This code is used in <a href="2-wn.html#SP14">&#167;14</a>.</li></ul>
<p class="commentary firstcommentary"><a id="SP14_2" class="paragraph-anchor"></a><b>&#167;14.2. </b> <span class="named-paragraph-container code-font"><span class="named-paragraph-defn">Entering classifier stanzas</span><span class="named-paragraph-number">14.2</span></span> =</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Regexp::match</span><span class="plain-syntax">(&amp;</span><span class="identifier-syntax">mr</span><span class="plain-syntax">, </span><span class="identifier-syntax">cmd</span><span class="plain-syntax">, </span><span class="identifier-syntax">U</span><span class="string-syntax">"classify"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">c_stanza</span><span class="plain-syntax"> = </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">main_classifier</span><span class="plain-syntax">; </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP14_5" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Setting done</span></span><span class="named-paragraph-number">14.5</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Regexp::match</span><span class="plain-syntax">(&amp;</span><span class="identifier-syntax">mr</span><span class="plain-syntax">, </span><span class="identifier-syntax">cmd</span><span class="plain-syntax">, </span><span class="identifier-syntax">U</span><span class="string-syntax">"residue of (%C+)"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">        </span><span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">R</span><span class="plain-syntax"> = </span><a href="2-lc2.html#SP16" class="function-link"><span class="function-syntax">LineClassifiers::outcome_by_name</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">mr</span><span class="plain-syntax">.</span><span class="identifier-syntax">exp</span><span class="plain-syntax">[0]);</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">R</span><span class="plain-syntax"> == </span><span class="constant-syntax">NO_LSNROID</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">error</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::new</span><span class="plain-syntax">();</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">WRITE_TO</span><span class="plain-syntax">(</span><span class="identifier-syntax">error</span><span class="plain-syntax">, </span><span class="string-syntax">"unknown outcome '%S'"</span><span class="plain-syntax">, </span><span class="identifier-syntax">mr</span><span class="plain-syntax">.</span><span class="identifier-syntax">exp</span><span class="plain-syntax">[0]);</span>
<span class="plain-syntax">        } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">c_stanza</span><span class="plain-syntax"> = </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">residue_classifier</span><span class="plain-syntax">[</span><span class="identifier-syntax">R</span><span class="plain-syntax">];</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">        </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP14_5" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Setting done</span></span><span class="named-paragraph-number">14.5</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Regexp::match</span><span class="plain-syntax">(&amp;</span><span class="identifier-syntax">mr</span><span class="plain-syntax">, </span><span class="identifier-syntax">cmd</span><span class="plain-syntax">, </span><span class="identifier-syntax">U</span><span class="string-syntax">"options of (%C+)"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">        </span><span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">R</span><span class="plain-syntax"> = </span><a href="2-lc2.html#SP16" class="function-link"><span class="function-syntax">LineClassifiers::outcome_by_name</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">mr</span><span class="plain-syntax">.</span><span class="identifier-syntax">exp</span><span class="plain-syntax">[0]);</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">R</span><span class="plain-syntax"> == </span><span class="constant-syntax">NO_LSNROID</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">error</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::new</span><span class="plain-syntax">();</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">WRITE_TO</span><span class="plain-syntax">(</span><span class="identifier-syntax">error</span><span class="plain-syntax">, </span><span class="string-syntax">"unknown outcome '%S'"</span><span class="plain-syntax">, </span><span class="identifier-syntax">mr</span><span class="plain-syntax">.</span><span class="identifier-syntax">exp</span><span class="plain-syntax">[0]);</span>
<span class="plain-syntax">        } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">c_stanza</span><span class="plain-syntax"> = </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">options_classifier</span><span class="plain-syntax">[</span><span class="identifier-syntax">R</span><span class="plain-syntax">];</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">        </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP14_5" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Setting done</span></span><span class="named-paragraph-number">14.5</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
</pre>
<ul class="endnotetexts"><li>This code is used in <a href="2-wn.html#SP14">&#167;14</a>.</li></ul>
<p class="commentary firstcommentary"><a id="SP14_3" class="paragraph-anchor"></a><b>&#167;14.3. </b> <span class="named-paragraph-container code-font"><span class="named-paragraph-defn">Miscellaneous settings</span><span class="named-paragraph-number">14.3</span></span> =</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Regexp::match</span><span class="plain-syntax">(&amp;</span><span class="identifier-syntax">mr</span><span class="plain-syntax">, </span><span class="identifier-syntax">cmd</span><span class="plain-syntax">, </span><span class="identifier-syntax">U</span><span class="string-syntax">"name \"(%C+)\""</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">name</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">mr</span><span class="plain-syntax">.</span><span class="identifier-syntax">exp</span><span class="plain-syntax">[0]); </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP14_5" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Setting done</span></span><span class="named-paragraph-number">14.5</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Regexp::match</span><span class="plain-syntax">(&amp;</span><span class="identifier-syntax">mr</span><span class="plain-syntax">, </span><span class="identifier-syntax">cmd</span><span class="plain-syntax">, </span><span class="identifier-syntax">U</span><span class="string-syntax">"recognise (.%C+)"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">ext</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">mr</span><span class="plain-syntax">.</span><span class="identifier-syntax">exp</span><span class="plain-syntax">[0]);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">ADD_TO_LINKED_LIST</span><span class="plain-syntax">(</span><span class="identifier-syntax">ext</span><span class="plain-syntax">, </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax">, </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">recognised_filename_extensions</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP14_5" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Setting done</span></span><span class="named-paragraph-number">14.5</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Regexp::match</span><span class="plain-syntax">(&amp;</span><span class="identifier-syntax">mr</span><span class="plain-syntax">, </span><span class="identifier-syntax">cmd</span><span class="plain-syntax">, </span><span class="identifier-syntax">U</span><span class="string-syntax">"end"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">error</span><span class="plain-syntax"> = </span><span class="identifier-syntax">I</span><span class="string-syntax">"unexpected 'end'"</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP14_5" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Setting done</span></span><span class="named-paragraph-number">14.5</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
</pre>
<ul class="endnotetexts"><li>This code is used in <a href="2-wn.html#SP14">&#167;14</a>.</li></ul>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP14_4" class="paragraph-anchor"></a><b>&#167;14.4. </b>  Inside a stanza, the only content allowed is a grammar rule.</p>
</div>
<p class="commentary"><span class="named-paragraph-container code-font"><span class="named-paragraph-defn">Inside stanzas</span><span class="named-paragraph-number">14.4</span></span> =</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Regexp::match</span><span class="plain-syntax">(&amp;</span><span class="identifier-syntax">mr</span><span class="plain-syntax">, </span><span class="identifier-syntax">cmd</span><span class="plain-syntax">, </span><span class="identifier-syntax">U</span><span class="string-syntax">"end"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">c_stanza</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">; </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">p_stanza</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP14_5" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Setting done</span></span><span class="named-paragraph-number">14.5</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">c_stanza</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Regexp::match</span><span class="plain-syntax">(&amp;</span><span class="identifier-syntax">mr</span><span class="plain-syntax">, </span><span class="identifier-syntax">cmd</span><span class="plain-syntax">, </span><span class="identifier-syntax">U</span><span class="string-syntax">"(%c*?) ==&gt; (%c*)"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">error</span><span class="plain-syntax"> = </span><a href="2-lc2.html#SP3" class="function-link"><span class="function-syntax">LineClassifiers::parse_rule</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">c_stanza</span><span class="plain-syntax">, </span><span class="identifier-syntax">mr</span><span class="plain-syntax">.</span><span class="identifier-syntax">exp</span><span class="plain-syntax">[0], </span><span class="identifier-syntax">mr</span><span class="plain-syntax">.</span><span class="identifier-syntax">exp</span><span class="plain-syntax">[1]);</span>
<span class="plain-syntax">        } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Regexp::match</span><span class="plain-syntax">(&amp;</span><span class="identifier-syntax">mr</span><span class="plain-syntax">, </span><span class="identifier-syntax">cmd</span><span class="plain-syntax">, </span><span class="identifier-syntax">U</span><span class="string-syntax">" *==&gt; (%c*)"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">error</span><span class="plain-syntax"> = </span><a href="2-lc2.html#SP3" class="function-link"><span class="function-syntax">LineClassifiers::parse_rule</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">c_stanza</span><span class="plain-syntax">, </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">, </span><span class="identifier-syntax">mr</span><span class="plain-syntax">.</span><span class="identifier-syntax">exp</span><span class="plain-syntax">[0]);</span>
<span class="plain-syntax">        } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">error</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::new</span><span class="plain-syntax">();</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">WRITE_TO</span><span class="plain-syntax">(</span><span class="identifier-syntax">error</span><span class="plain-syntax">, </span><span class="string-syntax">"not a grammar line: '%S'"</span><span class="plain-syntax">, </span><span class="identifier-syntax">cmd</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">        </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP14_5" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Setting done</span></span><span class="named-paragraph-number">14.5</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">p_stanza</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Regexp::match</span><span class="plain-syntax">(&amp;</span><span class="identifier-syntax">mr</span><span class="plain-syntax">, </span><span class="identifier-syntax">cmd</span><span class="plain-syntax">, </span><span class="identifier-syntax">U</span><span class="string-syntax">"(%c*?) ==&gt; (%c*)"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">error</span><span class="plain-syntax"> = </span><a href="2-wn.html#SP18" class="function-link"><span class="function-syntax">WebNotation::add_rewrite</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">, </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">p_stanza</span><span class="plain-syntax">, </span><span class="identifier-syntax">mr</span><span class="plain-syntax">.</span><span class="identifier-syntax">exp</span><span class="plain-syntax">[0], </span><span class="identifier-syntax">mr</span><span class="plain-syntax">.</span><span class="identifier-syntax">exp</span><span class="plain-syntax">[1]);</span>
<span class="plain-syntax">        } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">error</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::new</span><span class="plain-syntax">();</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">WRITE_TO</span><span class="plain-syntax">(</span><span class="identifier-syntax">error</span><span class="plain-syntax">, </span><span class="string-syntax">"not a process line: '%S'"</span><span class="plain-syntax">, </span><span class="identifier-syntax">cmd</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">        </span><span class="named-paragraph-container code-font"><a href="2-wn.html#SP14_5" class="named-paragraph-link"><span class="named-paragraph"><span class="mathjax_process">Setting done</span></span><span class="named-paragraph-number">14.5</span></a></span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
</pre>
<ul class="endnotetexts"><li>This code is used in <a href="2-wn.html#SP14">&#167;14</a>.</li></ul>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP14_5" class="paragraph-anchor"></a><b>&#167;14.5. </b>  And, in all cases, this is where we end up.</p>
</div>
<p class="commentary"><span class="named-paragraph-container code-font"><span class="named-paragraph-defn">Setting done</span><span class="named-paragraph-number">14.5</span></span> =</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    </span><span class="identifier-syntax">Regexp::dispose_of</span><span class="plain-syntax">(&amp;</span><span class="identifier-syntax">mr</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">error</span><span class="plain-syntax">;</span>
</pre>
<ul class="endnotetexts"><li>This code is used in <a href="2-wn.html#SP14">&#167;14</a> (twice), <a href="2-wn.html#SP14_1">&#167;14.1</a> (6 times), <a href="2-wn.html#SP14_2">&#167;14.2</a> (three times), <a href="2-wn.html#SP14_3">&#167;14.3</a> (three times) and <a href="2-wn.html#SP14_4">&#167;14.4</a> (three times).</li></ul>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP15" class="paragraph-anchor"></a><b>&#167;15. </b>  All WCL declarations are first parsed and then &quot;resolved&quot;. There's actually
nothing to do at the resolution stage except to tell the conventions system
how important our choices are (relative to languages, webs, etc.):</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="type-syntax">void</span><span class="plain-syntax"> </span><span class="function-syntax">WebNotation::resolve_declaration</span><button class="popup" onclick="togglePopup('usagePopup20')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup20">Usage of <span class="code-font"><span class="function-syntax">WebNotation::resolve_declaration</span></span>:<br/>Web Control Language - <a href="1-wcl.html#SP13">&#167;13</a></span></button><span class="plain-syntax">(</span><span class="type-syntax">wcl_declaration</span><span class="plain-syntax"> *</span><span class="identifier-syntax">D</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><a href="1-cnv.html#SP8" class="function-link"><span class="function-syntax">Conventions::set_level</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">D</span><span class="plain-syntax">, </span><span class="constant-syntax">NOTATION_LSCONVENTIONLEVEL</span><span class="plain-syntax">);</span>
<span class="plain-syntax">}</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP16" class="paragraph-anchor"></a><b>&#167;16. Processing.</b>  A &quot;notation rewriting machine&quot; is a form of finite state machine, set to recognise
the patterns needing to be rewritten.</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="reserved-syntax">typedef</span><span class="plain-syntax"> </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="type-syntax">notation_rewriting_machine</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">    </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">finite_state_machine</span><span class="plain-syntax"> *</span><span class="identifier-syntax">fsm</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">fsm_state</span><span class="plain-syntax"> *</span><span class="identifier-syntax">base_state</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">CLASS_DEFINITION</span>
<span class="plain-syntax">} </span><span class="type-syntax">notation_rewriting_machine</span><span class="plain-syntax">;</span>

<span class="type-syntax">notation_rewriting_machine</span><span class="plain-syntax"> *</span><span class="function-syntax">WebNotation::new_machine</span><button class="popup" onclick="togglePopup('usagePopup21')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup21">Usage of <span class="code-font"><span class="function-syntax">WebNotation::new_machine</span></span>:<br/><a href="2-wn.html#SP2">&#167;2</a></span></button><span class="plain-syntax">(</span><span class="type-syntax">void</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="type-syntax">notation_rewriting_machine</span><span class="plain-syntax"> *</span><span class="identifier-syntax">nrm</span><span class="plain-syntax"> = </span><span class="identifier-syntax">CREATE</span><span class="plain-syntax">(</span><span class="type-syntax">notation_rewriting_machine</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">nrm</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">base_state</span><span class="plain-syntax"> = </span><span class="identifier-syntax">FSM::new_state</span><span class="plain-syntax">(</span><span class="identifier-syntax">I</span><span class="string-syntax">"base"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">nrm</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">fsm</span><span class="plain-syntax"> = </span><span class="identifier-syntax">FSM::new_machine</span><span class="plain-syntax">(</span><span class="identifier-syntax">nrm</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">base_state</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">nrm</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>
</pre>
<ul class="endnotetexts"><li>The structure notation_rewriting_machine is private to this section.</li></ul>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP17" class="paragraph-anchor"></a><b>&#167;17. </b>  When the machine spots a rewrite, it then signals an <code>INWEB_REWRITE_FSMEVENT</code>,
which is supplemented by a pointer to one of these structures:</p>
</div>
<pre class="definitions code-font"><span class="definition-keyword">enumerate</span> <span class="identifier-syntax">INWEB_REWRITE_FSMEVENT</span> 
</pre>
<pre class="displayed-code all-displayed-code code-font">
<span class="reserved-syntax">typedef</span><span class="plain-syntax"> </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="type-syntax">notation_rewriter</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">    </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">from</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="type-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">to</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">CLASS_DEFINITION</span>
<span class="plain-syntax">} </span><span class="type-syntax">notation_rewriter</span><span class="plain-syntax">;</span>
</pre>
<ul class="endnotetexts"><li>The structure notation_rewriter is private to this section.</li></ul>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP18" class="paragraph-anchor"></a><b>&#167;18. </b>  And the following sets that up:</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="function-syntax">WebNotation::add_rewrite</span><button class="popup" onclick="togglePopup('usagePopup22')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup22">Usage of <span class="code-font"><span class="function-syntax">WebNotation::add_rewrite</span></span>:<br/><a href="2-wn.html#SP14_4">&#167;14.4</a></span></button><span class="plain-syntax">(</span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">, </span><span class="type-syntax">notation_rewriting_machine</span><span class="plain-syntax"> *</span><span class="identifier-syntax">nrm</span><span class="plain-syntax">,</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">from</span><span class="plain-syntax">, </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">to</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">nrm</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) </span><span class="identifier-syntax">internal_error</span><span class="plain-syntax">(</span><span class="string-syntax">"no fsm"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">error</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="type-syntax">notation_rewriter</span><span class="plain-syntax"> *</span><span class="identifier-syntax">nr</span><span class="plain-syntax"> = </span><span class="identifier-syntax">CREATE</span><span class="plain-syntax">(</span><span class="type-syntax">notation_rewriter</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">nr</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">from</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::duplicate</span><span class="plain-syntax">(</span><span class="identifier-syntax">from</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">nr</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">to</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::new</span><span class="plain-syntax">();</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">i</span><span class="plain-syntax">=0; </span><span class="identifier-syntax">i</span><span class="plain-syntax">&lt;</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">to</span><span class="plain-syntax">); </span><span class="identifier-syntax">i</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::includes_at</span><span class="plain-syntax">(</span><span class="identifier-syntax">to</span><span class="plain-syntax">, </span><span class="identifier-syntax">i</span><span class="plain-syntax">, </span><span class="identifier-syntax">I</span><span class="string-syntax">"&lt;SPACE&gt;"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">PUT_TO</span><span class="plain-syntax">(</span><span class="identifier-syntax">nr</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">to</span><span class="plain-syntax">, </span><span class="character-syntax">' '</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">i</span><span class="plain-syntax"> += </span><span class="constant-syntax">6</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::includes_at</span><span class="plain-syntax">(</span><span class="identifier-syntax">to</span><span class="plain-syntax">, </span><span class="identifier-syntax">i</span><span class="plain-syntax">, </span><span class="identifier-syntax">I</span><span class="string-syntax">"&lt;NOTHING&gt;"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">i</span><span class="plain-syntax"> += </span><span class="constant-syntax">8</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::includes_at</span><span class="plain-syntax">(</span><span class="identifier-syntax">to</span><span class="plain-syntax">, </span><span class="identifier-syntax">i</span><span class="plain-syntax">, </span><span class="identifier-syntax">I</span><span class="string-syntax">"&lt;TAB&gt;"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">PUT_TO</span><span class="plain-syntax">(</span><span class="identifier-syntax">nr</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">to</span><span class="plain-syntax">, </span><span class="character-syntax">'\t'</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">i</span><span class="plain-syntax"> += </span><span class="constant-syntax">5</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::includes_at</span><span class="plain-syntax">(</span><span class="identifier-syntax">to</span><span class="plain-syntax">, </span><span class="identifier-syntax">i</span><span class="plain-syntax">, </span><span class="identifier-syntax">I</span><span class="string-syntax">"&lt;LEFTANGLE&gt;"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">PUT_TO</span><span class="plain-syntax">(</span><span class="identifier-syntax">nr</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">to</span><span class="plain-syntax">, </span><span class="character-syntax">'&lt;'</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">i</span><span class="plain-syntax"> += </span><span class="constant-syntax">11</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::includes_at</span><span class="plain-syntax">(</span><span class="identifier-syntax">to</span><span class="plain-syntax">, </span><span class="identifier-syntax">i</span><span class="plain-syntax">, </span><span class="identifier-syntax">I</span><span class="string-syntax">"&lt;RIGHTANGLE&gt;"</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">PUT_TO</span><span class="plain-syntax">(</span><span class="identifier-syntax">nr</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">to</span><span class="plain-syntax">, </span><span class="character-syntax">'&gt;'</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">i</span><span class="plain-syntax"> += </span><span class="constant-syntax">12</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">PUT_TO</span><span class="plain-syntax">(</span><span class="identifier-syntax">nr</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">to</span><span class="plain-syntax">, </span><span class="identifier-syntax">Str::get_at</span><span class="plain-syntax">(</span><span class="identifier-syntax">to</span><span class="plain-syntax">, </span><span class="identifier-syntax">i</span><span class="plain-syntax">));</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">FSM::add_transition_spelling_out_with_events_and_parameter</span><span class="plain-syntax">(</span><span class="identifier-syntax">nrm</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">base_state</span><span class="plain-syntax">, </span><span class="identifier-syntax">from</span><span class="plain-syntax">,</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">nrm</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">base_state</span><span class="plain-syntax">, </span><span class="identifier-syntax">NO_FSMEVENT</span><span class="plain-syntax">, </span><span class="constant-syntax">INWEB_REWRITE_FSMEVENT</span><span class="plain-syntax">, </span><span class="identifier-syntax">STORE_POINTER_notation_rewriter</span><span class="plain-syntax">(</span><span class="identifier-syntax">nr</span><span class="plain-syntax">));</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">error</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP19" class="paragraph-anchor"></a><b>&#167;19. </b>  So much for building the rewriting machine: using it is easier.</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="type-syntax">void</span><span class="plain-syntax"> </span><span class="function-syntax">WebNotation::rewrite</span><button class="popup" onclick="togglePopup('usagePopup23')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup23">Usage of <span class="code-font"><span class="function-syntax">WebNotation::rewrite</span></span>:<br/><a href="2-wn.html#SP20">&#167;20</a><br/>Literate Source - <a href="2-ls.html#SP22">&#167;22</a><br/>Line Classification - <a href="2-lc.html#SP17">&#167;17</a></span></button><span class="plain-syntax">(</span><span class="identifier-syntax">OUTPUT_STREAM</span><span class="plain-syntax">, </span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">text</span><span class="plain-syntax">, </span><span class="type-syntax">notation_rewriting_machine</span><span class="plain-syntax"> *</span><span class="identifier-syntax">nrm</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">FSM::reset_machine</span><span class="plain-syntax">(</span><span class="identifier-syntax">nrm</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">fsm</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">i</span><span class="plain-syntax">=0; </span><span class="identifier-syntax">i</span><span class="plain-syntax">&lt;</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">text</span><span class="plain-syntax">); </span><span class="identifier-syntax">i</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">        </span><span class="type-syntax">inchar32_t</span><span class="plain-syntax"> </span><span class="identifier-syntax">c</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::get_at</span><span class="plain-syntax">(</span><span class="identifier-syntax">text</span><span class="plain-syntax">, </span><span class="identifier-syntax">i</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">PUT</span><span class="plain-syntax">(</span><span class="identifier-syntax">c</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">event</span><span class="plain-syntax"> = </span><span class="identifier-syntax">FSM::cycle_machine</span><span class="plain-syntax">(</span><span class="identifier-syntax">nrm</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">fsm</span><span class="plain-syntax">, </span><span class="identifier-syntax">c</span><span class="plain-syntax">, </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">event</span><span class="plain-syntax"> == </span><span class="constant-syntax">INWEB_REWRITE_FSMEVENT</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">general_pointer</span><span class="plain-syntax"> </span><span class="identifier-syntax">parameter</span><span class="plain-syntax"> = </span><span class="identifier-syntax">FSM::get_last_parameter</span><span class="plain-syntax">(</span><span class="identifier-syntax">nrm</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">fsm</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="type-syntax">notation_rewriter</span><span class="plain-syntax"> *</span><span class="identifier-syntax">nr</span><span class="plain-syntax"> = </span><span class="identifier-syntax">RETRIEVE_POINTER_notation_rewriter</span><span class="plain-syntax">(</span><span class="identifier-syntax">parameter</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="type-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">backspace</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">nr</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">from</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">Str::truncate</span><span class="plain-syntax">(</span><span class="identifier-syntax">OUT</span><span class="plain-syntax">, </span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">OUT</span><span class="plain-syntax">) </span><span class="constant-syntax">-</span><span class="plain-syntax"> </span><span class="identifier-syntax">backspace</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">WRITE</span><span class="plain-syntax">(</span><span class="string-syntax">"%S"</span><span class="plain-syntax">, </span><span class="identifier-syntax">nr</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">to</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">}</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP20" class="paragraph-anchor"></a><b>&#167;20. </b>  And in particular:</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="type-syntax">void</span><span class="plain-syntax"> </span><span class="function-syntax">WebNotation::postprocess</span><button class="popup" onclick="togglePopup('usagePopup24')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup24">Usage of <span class="code-font"><span class="function-syntax">WebNotation::postprocess</span></span>:<br/>Literate Source - <a href="2-ls.html#SP8_4_1">&#167;8.4.1</a>, <a href="2-ls.html#SP12">&#167;12</a><br/>Line Classification - <a href="2-lc.html#SP17_1">&#167;17.1</a><br/>Code Excerpts - <a href="2-ce.html#SP5">&#167;5</a></span></button><span class="plain-syntax">(</span><span class="identifier-syntax">text_stream</span><span class="plain-syntax"> *</span><span class="identifier-syntax">text</span><span class="plain-syntax">, </span><span class="type-syntax">ls_notation</span><span class="plain-syntax"> *</span><span class="identifier-syntax">ntn</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::len</span><span class="plain-syntax">(</span><span class="identifier-syntax">text</span><span class="plain-syntax">) == </span><span class="constant-syntax">0</span><span class="plain-syntax">) </span><span class="reserved-syntax">return</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">TEMPORARY_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">processed</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><a href="2-wn.html#SP19" class="function-link"><span class="function-syntax">WebNotation::rewrite</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">processed</span><span class="plain-syntax">, </span><span class="identifier-syntax">text</span><span class="plain-syntax">, </span><span class="identifier-syntax">ntn</span><span class="plain-syntax">-&gt;</span><span class="element-syntax">postprocessor</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">Str::ne</span><span class="plain-syntax">(</span><span class="identifier-syntax">processed</span><span class="plain-syntax">, </span><span class="identifier-syntax">text</span><span class="plain-syntax">)) { </span><span class="identifier-syntax">Str::clear</span><span class="plain-syntax">(</span><span class="identifier-syntax">text</span><span class="plain-syntax">); </span><span class="identifier-syntax">Str::copy</span><span class="plain-syntax">(</span><span class="identifier-syntax">text</span><span class="plain-syntax">, </span><span class="identifier-syntax">processed</span><span class="plain-syntax">); }</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">DISCARD_TEXT</span><span class="plain-syntax">(</span><span class="identifier-syntax">processed</span><span class="plain-syntax">)</span>
<span class="plain-syntax">}</span>
</pre>
<nav role="progress"><div class="progresscontainer">
    <ul class="progressbar"><li class="progressprev"><a href="2-we.html">&#10094;</a></li><li class="progresschapter"><a href="P-abgtl.html">P</a></li><li class="progresschapter"><a href="1-lm.html">1</a></li><li class="progresscurrentchapter">2</li><li class="progresssection"><a href="2-ls.html">ls</a></li><li class="progresssection"><a href="2-pt.html">pt</a></li><li class="progresssection"><a href="2-lc.html">lc</a></li><li class="progresssection"><a href="2-lc2.html">lc2</a></li><li class="progresssection"><a href="2-we.html">we</a></li><li class="progresscurrent">wn</li><li class="progresssection"><a href="2-hln.html">hln</a></li><li class="progresssection"><a href="2-hs.html">hs</a></li><li class="progresssection"><a href="2-ce.html">ce</a></li><li class="progresssection"><a href="2-wi.html">wi</a></li><li class="progresschapter"><a href="3-pl.html">3</a></li><li class="progresschapter"><a href="4-tt.html">4</a></li><li class="progresschapter"><a href="5-wd.html">5</a></li><li class="progresschapter"><a href="6-mkf.html">6</a></li><li class="progressnext"><a href="2-hln.html">&#10095;</a></li></ul></div>
</nav><!-- End of weave -->

		</main>
	</body>
</html>

